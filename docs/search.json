[
  {
    "objectID": "rational_epicardial_reprogramming.html#preparation",
    "href": "rational_epicardial_reprogramming.html#preparation",
    "title": "Rational Epicardial Reprogramming with 10 Transcription Factors by Reprogram-Seq",
    "section": "Preparation",
    "text": "Preparation\n\n\n\nFunctions\n\n\n\nLoad required packages.\n\nlibrary(tidyverse)\nlibrary(Matrix)\nlibrary(patchwork)\nlibrary(extrafont)\n\n\nsource(file = file.path(SCRIPT_DIR, \"utilities.R\"))\n\n\n`%+replace%` <- ggplot2::`%+replace%`\n\n\n\n\nSymbols\n\nPROJECT_DIR <- file.path(\n    \"/Users/jialei/Dropbox/Data/Projects/UTSW/Cellular_reprogramming\",\n    \"Cardiac_reprogramming/Data_submission/Github\"\n)\n\n\ngene_symbols <- vroom::vroom(\n    file = file.path(\n        PROJECT_DIR, \"data\", \"misc\", \"genes.tsv\"\n    ),\n    col_names = FALSE\n)\n\ngene_symbols <- setNames(object = gene_symbols$X2, nm = gene_symbols$X1)\ngene_symbols |> head()\n\nENSMUSG00000051951 ENSMUSG00000089699 ENSMUSG00000102343 ENSMUSG00000025900 \n            \"Xkr4\"           \"Gm1992\"          \"Gm37381\"              \"Rp1\" \nENSMUSG00000109048 ENSMUSG00000025902 \n             \"Rp1\"            \"Sox17\" \n\n\n\nlength(gene_symbols)\n\n[1] 27999\n\n\nMatrix\n\nmatrix_readcount_use <- Matrix::sparseMatrix(\n    i = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_indices.rds\"\n        )\n    ),\n    p = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_indptr.rds\"\n        )\n    ),\n    x = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_values.rds\"\n        )\n    ),\n    dims = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_shape.rds\"\n        )\n    ),\n    dimnames = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_dimnames.rds\"\n        )\n    ),\n    index1 = FALSE\n)\n\n\ndim(matrix_readcount_use)\n\n[1] 27999 34564\n\n\n\nrownames(matrix_readcount_use) <- paste(\n    rownames(matrix_readcount_use),\n    gene_symbols[rownames(matrix_readcount_use)],\n    sep = \"_\"\n)\n\nmatrix_readcount_use[1:5, 1:5] |>\n    as.matrix() |>\n    knitr::kable()\n\n\n\n\n\n\n\n\n\n\n\n\nBL5_AAACCTGCACTACAGT\nBL5_AAACCTGCAGTACACT\nBL5_AAACCTGGTTCACGGC\nBL5_AAACCTGGTTGCTCCT\nBL5_AAACCTGTCCAACCAA\n\n\n\nENSMUSG00000051951_Xkr4\n0\n0\n0\n0\n0\n\n\nENSMUSG00000089699_Gm1992\n0\n0\n0\n0\n0\n\n\nENSMUSG00000102343_Gm37381\n0\n0\n0\n0\n0\n\n\nENSMUSG00000025900_Rp1\n0\n0\n0\n0\n0\n\n\nENSMUSG00000109048_Rp1\n0\n0\n0\n0\n0\n\n\n\n\n\nEmbedding\n\nembedding <- readRDS(\n    file = file.path(\n        PROJECT_DIR, \"data/10x/epicardial_10f_d7\", \"tsne_out_coords.rds\"\n    )\n)\n\n\ndim(embedding)\n\n[1] 22140     6\n\n\n\nCheck memory usage.\n\npurrr::walk(\n    list(matrix_readcount_use, embedding), \\(x) {\n        print(object.size(x), units = \"auto\", standard = \"SI\")\n    }\n)\n\n1.1 GB\n2.8 MB"
  },
  {
    "objectID": "rational_epicardial_reprogramming.html#clustering",
    "href": "rational_epicardial_reprogramming.html#clustering",
    "title": "Rational Epicardial Reprogramming with 10 Transcription Factors by Reprogram-Seq",
    "section": "Clustering",
    "text": "Clustering\n\nx_column <- \"x\"\ny_column <- \"y\"\n\nGEOM_POINT_SIZE <- 0.5\nEMBEDDING_TITLE_PREFIX <- \"t-SNE\"\nRASTERISED <- FALSE\n\nEmbedding\n\nembedding |>\n    tibble::rownames_to_column(var = \"cell\") |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::rename(batch = batch.id) |>\n    dplyr::group_by(batch) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            batch %in% c(\"BL5\", \"BL6\") ~ \"Primary\",\n            batch %in% c(\"BL7\") ~ \"Control\",\n            TRUE ~ \"Reprogrammed\"\n        ),\n        group = factor(\n            group,\n            levels = c(\"Primary\", \"Control\", \"Reprogrammed\")\n        )\n    ) |>\n    dplyr::arrange(group) |>\n    dplyr::select(\n        group, dplyr::everything()\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(group),\n        colors = scales::col_factor(\n            palette = paletteer::paletteer_d(\n                n = 3, palette = \"colorblindr::OkabeIto\"\n            ) |> as.character(),\n            domain = NULL\n        )\n    ) |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(batch),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(median_umis:median_features),\n        fns = list(\n            Mean = ~ mean(.)\n        ),\n        decimals = 2\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**10x Genomics**; Batch\")\n    )\n\n\n\n\n\n\n\n10x Genomics; Batch\n    \n\n\n      group\n      batch\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\nPrimary\nBL5\n5888\n4831\n1673.5\n\n\n\nPrimary\nBL6\n6047\n4521\n1570.0\n\n\n\nControl\nBL7\n4914\n13713\n3571.0\n\n\n\nReprogrammed\nBL8\n5291\n10534\n3043.0\n\n\nCount\n—\n4\n—\n—\n—\n\n\nSum\n—\n—\n22,140\n—\n—\n\n\nMean\n—\n—\n—\n8,399.75\n2,464.38\n\n\n\n\n\n\n\nembedding <- embedding |>\n    tibble::rownames_to_column(var = \"cell\") |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            category %in% c(\"BL5\", \"BL6\") ~ \"Primary\",\n            category %in% c(\"BL7\") ~ \"Control\",\n            TRUE ~ \"Reprogrammed\"\n        ),\n        group = factor(\n            group,\n            levels = c(\"Primary\", \"Reprogrammed\", \"Control\")\n        )\n    )\n\nCluster\n\np_embedding_cluster <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$cluster |> as.factor(),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Cluster\"),\n    color_labels = TRUE,\n    color_legend = FALSE,\n    sort_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding()\n\np_embedding_UMI <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = log10(Matrix::colSums(matrix_readcount_use[, embedding$cell])),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; UMI\"),\n    color_legend = TRUE,\n    sort_values = FALSE,\n    shuffle_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding()\n\np_embedding_MT <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = (colSums(matrix_readcount_use[\n        stringr::str_detect(\n            string = stringr::str_remove(\n                string = rownames(matrix_readcount_use),\n                pattern = \"^E.+_\"\n            ),\n            pattern = \"mt-\"\n        ),\n    ]) / colSums(matrix_readcount_use))[embedding$cell],\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; MT %\"),\n    color_legend = TRUE,\n    sort_values = TRUE,\n    shuffle_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) + theme_customized_embedding()\n\np_embedding_group <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$group |> as.factor(),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Group\"),\n    color_labels = FALSE,\n    color_legend = TRUE,\n    sort_values = FALSE,\n    shuffle_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding() +\n    ggplot2::scale_color_manual(\n        values = c(\n            Primary = \"#00AFBB\",\n            Reprogrammed = \"#8BC34A\",\n            Control = \"#E7B800\"\n        )\n    )\n\n\n\n\n\n\n\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(cluster) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(cluster),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**10x Genomics**; Clustering\")\n    )\n\n\n\n\n\n\n\n10x Genomics; Clustering\n    \n\n\n      cluster\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\n1\n3240\n15464.0\n3820.0\n\n\n\n2\n2259\n2390.0\n997.0\n\n\n\n3\n1914\n12506.5\n3352.5\n\n\n\n4\n1707\n14631.0\n3845.0\n\n\n\n5\n1330\n5696.5\n1564.5\n\n\n\n6\n1329\n5189.0\n1451.0\n\n\n\n7\n1222\n6010.0\n2147.0\n\n\n\n8\n1213\n7804.0\n2151.0\n\n\n\n9\n1093\n5399.0\n2239.0\n\n\n\n10\n1082\n11149.5\n3049.0\n\n\n\n11\n850\n7452.5\n2738.0\n\n\n\n12\n848\n2341.0\n773.0\n\n\n\n13\n638\n3925.5\n985.0\n\n\n\n14\n578\n4939.5\n2170.5\n\n\n\n15\n508\n5815.0\n1808.0\n\n\n\n16\n404\n5027.5\n1714.0\n\n\n\n17\n393\n5241.0\n2151.0\n\n\n\n18\n380\n7976.5\n2464.5\n\n\n\n19\n299\n6724.0\n2777.0\n\n\n\n20\n280\n5360.5\n1906.5\n\n\n\n21\n148\n2981.5\n1140.5\n\n\n\n22\n117\n5305.0\n1954.0\n\n\n\n23\n95\n2586.0\n1370.0\n\n\n\n24\n92\n4966.5\n280.0\n\n\n\n25\n64\n6244.5\n2619.5\n\n\n\n26\n57\n4898.0\n251.0\n\n\nCount\n26\n—\n—\n—\n\n\nSum\n—\n22,140\n—\n—\n\n\n\n\n\n\n\n\n\n\npurrr::reduce(\n    list(\n        p_embedding_cluster,\n        p_embedding_UMI,\n        p_embedding_MT,\n        p_embedding_group\n    ),\n    `+`\n) +\n    patchwork::plot_layout(ncol = 2) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\n\nlibrary(formattable)\n\n\nAttaching package: 'formattable'\n\n\nThe following object is masked from 'package:patchwork':\n\n    area\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(group) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    formattable::formattable(\n        list(\n            # num_cells = formattable::color_tile(\"transparent\", \"lightpink\"),\n            num_cells = formattable::color_bar(\"Lightpink\"),\n            median_umis = formattable::color_bar(\"lightgreen\"),\n            median_features = formattable::color_bar(\"lightblue\")\n        ),\n        full_width = FALSE,\n        caption = \"10x Genomics; Group\"\n    )\n\n\n\n\n10x Genomics; Group\n\n\n\ngroup\n\n\nnum_cells\n\n\nmedian_umis\n\n\nmedian_features\n\n\n\n\n\nPrimary\n\n\n11935\n\n\n4672\n\n\n1620\n\n\n\n\nReprogrammed\n\n\n5291\n\n\n10534\n\n\n3043\n\n\n\n\nControl\n\n\n4914\n\n\n13713\n\n\n3571\n\n\n\n\n\n\n\npurrr::map(levels(embedding$group), \\(x) {\n    plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = as.integer(embedding$group == x) |> as.factor(),\n        label = glue::glue(\n            \"{EMBEDDING_TITLE_PREFIX}; {x}: {sum(embedding$group == x)}\"\n        ),\n        color_labels = FALSE,\n        color_legend = FALSE,\n        sort_values = FALSE,\n        shuffle_values = TRUE,\n        rasterise = RASTERISED,\n        geom_point_size = GEOM_POINT_SIZE\n    ) +\n        theme_customized_embedding() +\n        ggplot2::scale_color_manual(\n            values = c(\"grey70\", \"salmon\")\n        )\n}) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 3) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nExtract colors from the initial plots to keep colors consistent.\n\ncolor_palette <- ggplot2::ggplot_build(p_embedding_cluster)$data[[1]] |>\n    dplyr::select(color = colour, cluster = group) |>\n    unique() |>\n    dplyr::arrange(cluster)\n\ncolor_palette <- setNames(\n    object = color_palette$color,\n    nm = color_palette$cluster\n)\n\nscales::show_col(color_palette)\n\n\n\n\n\n\n\nPolished\n\n\n\n\np_embedding_cluster <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$cluster |> as.factor(),\n    label = NULL,\n    color_labels = TRUE,\n    color_legend = FALSE,\n    sort_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding(void = TRUE)\n\np_embedding_cluster\n\n\n\n\n\n\n\n\ncluster_labels <- embedding |>\n    dplyr::group_by(cluster) |>\n    dplyr::summarise(\n        x = median(x),\n        y = median(y)\n    ) |>\n    as.data.frame()\ncluster_labels[25, c(2, 3)] <- c(-32.5, -8.5)\n\npolygon_coordinates_cluster10 <- data.frame(\n    x = c(\n        -23, -26, -26, -24, -25.5, -27, -25, -24, -23, -20.5,\n        -18.5, -18, -19.5, -18.5, -19, -18, -18, -17.5, -17, -15.5,\n        -17, -16, -15, -14, -12, -11.5, -12, -10.5, -10.5, -9.5,\n        -9, -7, -7, -6, -5, -5.5, -5.5, -5.5, -5, -5,\n        -3.5, -6, -9, -9.5, -11.5, -13, -19\n    ),\n    y = c(\n        -25, -21, -18, -15, -14.5, -11, -4, -1, 3, 0,\n        3, 2.5, -7, -9, -12, -11, -12.5, -12, -11, -10.5,\n        -9, -8, -8, -10, -9.5, -10.5, -14, -14.5, -13, -12.5,\n        -11.5, -11, -12, -12, -12, -15, -18, -18, -18, -19,\n        -20, -22, -21, -23, -25, -25.5, -25.5\n    )\n)\n\nlayers <- list(\n    ggplot2::annotate(\n        geom = \"text\",\n        x = cluster_labels[, \"x\"],\n        y = cluster_labels[, \"y\"], label = cluster_labels[, 1],\n        parse = TRUE,\n        size = 2,\n        color = c(\"black\")\n    ),\n    ggplot2::geom_polygon(\n        data = polygon_coordinates_cluster10,\n        ggplot2::aes(x, y), fill = NA, color = \"black\", linewidth = .3\n    ),\n    ggplot2::annotate(\n        geom = \"path\",\n        x = -32.5 + 2.5 * cos(seq(0, 2 * pi, length.out = 100)),\n        y = -17 + 32.5 / 16.5 * 2.5 * sin(seq(0, 2 * pi, length.out = 100)),\n        color = \"#00BFC4\",\n        linewidth = .3\n    )\n)\n\np_embedding_reprogrammed <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = as.integer(embedding$group == \"Reprogrammed\") |> as.factor(),\n    label = NULL,\n    color_labels = TRUE,\n    color_legend = FALSE,\n    sort_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding(void = TRUE) +\n    ggplot2::scale_color_manual(\n        values = c(\"grey70\", \"salmon\")\n    ) +\n    layers +\n    ggplot2::annotate(\n        geom = \"text\",\n        x = -82.06687,\n        y = 76.43042,\n        label = \"10F\\nreprogrammed\\nMEFs\",\n        family = \"Arial\",\n        color = \"#FF5722\",\n        size = 2.5,\n        vjust = \"inward\", hjust = \"inward\"\n    ) +\n    ggplot2::annotate(\n        geom = \"text\",\n        family = \"Arial\",\n        x = -72,\n        y = -67,\n        label = \"Primary\\nepicardial cells\",\n        color = \"#00BFC4\",\n        size = 2,\n        vjust = \"inward\", hjust = \"inward\"\n    ) +\n    ggplot2::annotate(\n        geom = \"segment\",\n        x = -42,\n        xend = -35,\n        y = -55,\n        yend = -24,\n        color = \"#00BFC4\", size = .2,\n        arrow = ggplot2::arrow(\n            length = ggplot2::unit(1, \"mm\"), ends = \"last\",\n            type = \"closed\"\n        )\n    )\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0. Please use\n`linewidth` instead.\nℹ The deprecated feature was likely used in the ggplot2 package.\n  Please report the issue at <https://github.com/tidyverse/ggplot2/issues>.\n\np_embedding_uninfected <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = as.integer(embedding$group == \"Control\") |> as.factor(),\n    label = NULL,\n    color_labels = TRUE,\n    color_legend = FALSE,\n    sort_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized() +\n    theme_customized_void() +\n    ggplot2::scale_color_manual(\n        values = c(\"grey70\", \"salmon\")\n    ) +\n    layers +\n    ggplot2::annotate(\n        geom = \"text\",\n        x = -82.06687,\n        y = 76.43042,\n        label = \"Uninfected\\nMEFs\",\n        family = \"Arial\",\n        color = \"#FF5722\",\n        size = 2.5,\n        vjust = \"inward\", hjust = \"inward\"\n    )\n\nWarning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\nPlease use the `linewidth` argument instead.\n\n\n\nlist(\n    p_embedding_reprogrammed,\n    p_embedding_uninfected\n) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nComposition\n\n\n\n\ncalc_group_composition(\n    data = embedding,\n    x = \"cluster\",\n    group = \"group\"\n) |>\n    dplyr::mutate(\n        cluster = factor(\n            cluster\n        )\n    ) |>\n    plot_barplot(\n        x = \"cluster\",\n        y = \"percentage\",\n        z = \"group\",\n        legend_ncol = 1,\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            Primary = \"#00AFBB\",\n            Reprogrammed = \"#8BC34A\",\n            Control = \"#E7B800\"\n        )\n    )\n\n\n\n\n\n\n\n\nclusters_selected <- c(1, 3, 4, 6, 10, 16, 17, 22)\n\npurrr::map(clusters_selected, \\(x) {\n    cells_1 <- embedding$cell[\n        (embedding$cluster == x) & (embedding$category == \"BL8\")\n    ]\n    cells_2 <- embedding$cell[\n        (embedding$cluster == x) & (embedding$category == \"BL7\")\n    ]\n    data.frame(\n        cluster = x,\n        ratio = length(cells_1) / length(cells_2)\n    )\n}) |>\n    dplyr::bind_rows() |>\n    dplyr::mutate(\n        cluster = factor(\n            cluster,\n            levels = clusters_selected |> rev()\n        )\n    ) |>\n    ggplot(\n        aes(\n            y = cluster,\n            x = ratio,\n            fill = cluster\n        )\n    ) +\n    ggplot2::geom_bar(stat = \"identity\") +\n    theme_customized_violin() +\n    ggplot2::guides(fill = \"none\") +\n    ggplot2::scale_y_discrete(\n        name = \"MEF-derived cluster\"\n    ) +\n    ggplot2::scale_x_continuous(\n        name = \"Ratio\\n(reprogrammed / uninfected MEF)\",\n        breaks = seq(1, 9, 2)\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            rep(\"grey35\", 3),\n            \"#FF5722\",\n            rep(\"grey35\", 4)\n        )\n    ) +\n    ggplot2::geom_vline(xintercept = 1, linetype = 2, size = .2)"
  },
  {
    "objectID": "rational_epicardial_reprogramming.html#expression",
    "href": "rational_epicardial_reprogramming.html#expression",
    "title": "Rational Epicardial Reprogramming with 10 Transcription Factors by Reprogram-Seq",
    "section": "Expression",
    "text": "Expression\nEmbedding\n\nFEATURES_SELECTED <- c(\n    \"ENSMUSG00000009471_Myod1\",\n    \"ENSMUSG00000026414_Tnnt2\",\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\",\n    \"ENSMUSG00000049382_Krt8\",\n    \"ENSMUSG00000079018_Ly6c1\",\n    \"ENSMUSG00000049436_Upk1b\",\n    \"ENSMUSG00000021391_Cenpp\"\n)\n\n\npurrr::map(FEATURES_SELECTED, \\(x) {\n    selected_feature <- x\n\n    cat(selected_feature, \"\\n\")\n    values <- log10(\n        calc_cpm(matrix_readcount_use[, embedding$cell])\n        [selected_feature, ] + 1\n    )\n\n    p1 <- plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = values,\n        label = paste(\n            EMBEDDING_TITLE_PREFIX,\n            selected_feature |> stringr::str_remove(pattern = \"^E.+_\"),\n            sep = \"; \"\n        ),\n        color_legend = TRUE,\n        sort_values = TRUE,\n        rasterise = RASTERISED,\n        geom_point_size = GEOM_POINT_SIZE * 1.25,\n        na_value = \"grey80\"\n    ) +\n        theme_customized_embedding()\n\n    return(p1)\n}) |>\n    # unlist(recursive = FALSE) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2, byrow = FALSE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\nENSMUSG00000009471_Myod1 \nENSMUSG00000026414_Tnnt2 \nENSMUSG00000016458_Wt1 \nENSMUSG00000025105_Bnc1 \nENSMUSG00000049382_Krt8 \nENSMUSG00000079018_Ly6c1 \nENSMUSG00000049436_Upk1b \nENSMUSG00000021391_Cenpp \n\n\n\n\n\n\n\n\nBar plot\n\n\n\n\n\n\n\nbarplot_helper <- function(cells, features, matrix_readcount) {\n    purrr::map(names(cells), \\(x) {\n        calc_cpm(matrix_readcount)[\n            features,\n            colnames(matrix_readcount) %in% cells[[x]]\n        ] |>\n            Matrix::rowMeans() |>\n            tibble::enframe(name = \"feature\") |>\n            dplyr::mutate(group = x)\n    }) |>\n        dplyr::bind_rows()\n}\n\n\n\n\n\ncells_barplot <- list(\n    embedding |>\n        dplyr::filter(\n            cluster == 25 & category %in% c(\"BL5\", \"BL6\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            cluster == 10 & category %in% c(\"BL8\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            cluster != 10 & category %in% c(\"BL8\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            category %in% (\"BL7\")\n        ) |>\n        dplyr::pull(cell)\n)\nnames(cells_barplot) <- c(\n    \"Primary epi.\", \"Cluster10\",\n    \"Other\", \"Uninfected MEF\"\n)\n\nfeatures_barplot <- c(\n    \"ENSMUSG00000021950_Anxa8\",\n    \"ENSMUSG00000015627_Gata5\",\n    \"ENSMUSG00000031517_Gpm6a\",\n    \"ENSMUSG00000020911_Krt19\",\n    \"ENSMUSG00000049436_Upk1b\"\n)\n\nbarplot_helper(cells_barplot, features_barplot, matrix_readcount_use) |>\n    dplyr::mutate(\n        feature = stringr::str_remove(string = feature, pattern = \"^.+_\")\n    ) |>\n    dplyr::mutate(\n        value = log10(value + 1),\n        group = factor(group, levels = names(cells_barplot))\n    ) |>\n    plot_barplot_simple(\n        x = \"group\",\n        y = \"value\",\n        z = \"feature\",\n        y_title = expression(\"Avg expr; log\"[10] * \" (CPM + 1)\")\n    ) +\n    theme_customized_violin(\n        strip_background_fill = \"grey80\",\n        panel_border_color = \"black\",\n        axis_text_x_angle = c(90, 1, 0.5)\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            c(\n                \"#00BFC4\",\n                \"#FF5722\",\n                \"grey35\",\n                \"grey35\"\n            )\n        )\n    )"
  },
  {
    "objectID": "rational_epicardial_reprogramming.html#enrichment-of-exogenous-factors",
    "href": "rational_epicardial_reprogramming.html#enrichment-of-exogenous-factors",
    "title": "Rational Epicardial Reprogramming with 10 Transcription Factors by Reprogram-Seq",
    "section": "Enrichment of exogenous factors",
    "text": "Enrichment of exogenous factors\n\nfeatures_selected_10 <- c(\n    \"ENSMUSG00000026628_Atf3\",\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\",\n    \"ENSMUSG00000051910_Sox6\",\n    \"ENSMUSG00000045680_Tcf21\",\n    \"ENSMUSG00000038193_Hand2\",\n    \"ENSMUSG00000031965_Tbx20\",\n    \"ENSMUSG00000032419_Tbx18\",\n    \"ENSMUSG00000005836_Gata6\",\n    \"ENSMUSG00000036098_Myrf\"\n)\n\n\nclusters_selected <- c(1, 3, 4, 6, 10, 16, 17, 22)\n\nenriched_factors <- do.call(\n    rbind.data.frame,\n    lapply(clusters_selected, \\(x) {\n        cells_1 <- embedding$cell[\n            embedding$cluster == x & embedding$category == \"BL8\"\n        ]\n        cells_2 <- embedding$cell[\n            embedding$cluster != x & embedding$category == \"BL8\"\n        ]\n        cat(x, length(cells_1), length(cells_2), \"\\n\")\n\n        de_paired <- detect_de(\n            cell_group_a = cells_1,\n            cell_group_b = cells_2,\n            matrix_readcount = matrix_readcount_use,\n            matrix_cpm = calc_cpm(matrix_readcount_use),\n            only_enrichment = TRUE\n        ) |>\n            dplyr::mutate(category = x) |>\n            tibble::rownames_to_column(var = \"feature\") |>\n            dplyr::filter(feature %in% features_selected_10)\n    })\n) |>\n    dplyr::filter(category %in% clusters_selected) |>\n    dplyr::mutate(\n        category = factor(category,\n            levels = clusters_selected\n        ),\n        symbol = stringr::str_remove(\n            string = feature,\n            pattern = \"^.+_\"\n        )\n    )\n\n1 1473 3818 \n3 932 4359 \n4 826 4465 \n6 687 4604 \n10 974 4317 \n16 178 5113 \n17 87 5204 \n22 61 5230 \n\n\n\nDifferential expression analysis of 10F in MEF-derived clusters, as compared with all other reprogrammed cells. Each dot represents a gene (colored by fold change and sized by p value).\n\nggplot2::ggplot() +\n    ggplot2::geom_abline(intercept = 0, slope = 1, linetype = 2) +\n    ggplot2::geom_point(\n        data = enriched_factors,\n        ggplot2::aes(positive_frac_b,\n            positive_frac_a,\n            size = -log10(pval_adj),\n            color = log2_effect\n        ),\n        alpha = .8,\n        stroke = 0, shape = 16\n    ) +\n    ggplot2::facet_wrap(\n        ~category,\n        ncol = 2,\n        labeller = ggplot2::labeller(\n            category = setNames(\n                object = paste(\"Cluster\", clusters_selected),\n                nm = clusters_selected\n            )\n        )\n    ) +\n    ggplot2::coord_fixed() +\n    ggplot2::scale_color_viridis_c(\n        name = expression(paste(\"Log\"[2], \" effect\"))\n    ) +\n    ggplot2::scale_size_continuous(\n        name = expression(paste(\"-log\"[10], \" (p-value)\"))\n    ) +\n    ggplot2::guides(\n        color = ggplot2::guide_colorbar(order = 1),\n        size = ggplot2::guide_legend(order = 2)\n    ) +\n    ggplot2::scale_x_continuous(\n        name = \"Expr (%, other reprogrammed cells)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    ggplot2::scale_y_continuous(\n        name = \"Expr (%, indicated cluster)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    theme_customized_violin() +\n    ggplot2::theme(\n        legend.background = ggplot2::element_blank(),\n        legend.margin = ggplot2::margin(\n            t = 0, r = 0, b = 0, l = 0, unit = \"mm\"\n        ),\n        legend.key.size = ggplot2::unit(2.5, \"mm\"),\n        legend.text = ggplot2::element_text(family = \"Arial\", size = 6),\n        legend.title = ggplot2::element_text(family = \"Arial\", size = 6),\n        legend.position = \"right\",\n        # legend.box = \"horizontal\",\n        legend.box = \"vertical\",\n        legend.box.background = ggplot2::element_blank()\n    ) +\n    ggrepel::geom_text_repel(\n        data = enriched_factors,\n        ggplot2::aes(\n            positive_frac_b,\n            positive_frac_a,\n            label = symbol\n        ),\n        #\n        size = 5 / ggplot2::.pt,\n        family = \"Arial\",\n        box.padding = .2,\n        point.padding = .2,\n        nudge_y = .15,\n        arrow = ggplot2::arrow(length = ggplot2::unit(.02, \"npc\")),\n        segment.color = \"grey35\",\n        color = \"black\"\n    )"
  },
  {
    "objectID": "rational_epicardial_reprogramming.html#r-session-info",
    "href": "rational_epicardial_reprogramming.html#r-session-info",
    "title": "Rational Epicardial Reprogramming with 10 Transcription Factors by Reprogram-Seq",
    "section": "R session info",
    "text": "R session info\n\ndevtools::session_info()\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23)\n os       macOS Monterey 12.6\n system   aarch64, darwin21.6.0\n ui       unknown\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       America/Chicago\n date     2022-09-24\n pandoc   2.19.2 @ /opt/homebrew/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version       date (UTC) lib source\n bit           4.0.4         2020-08-04 [1] CRAN (R 4.2.0)\n bit64         4.0.5         2020-08-30 [1] CRAN (R 4.2.0)\n cachem        1.0.6         2021-08-19 [1] CRAN (R 4.2.0)\n callr         3.7.2         2022-08-22 [1] CRAN (R 4.2.1)\n cli           3.4.1         2022-09-23 [1] CRAN (R 4.2.1)\n colorspace    2.0-3         2022-02-21 [1] CRAN (R 4.2.0)\n commonmark    1.8.0         2022-03-09 [1] CRAN (R 4.2.0)\n crayon        1.5.1         2022-03-26 [1] CRAN (R 4.2.0)\n devtools      2.4.4.9000    2022-09-23 [1] Github (r-lib/devtools@9e2793a)\n digest        0.6.29        2021-12-01 [1] CRAN (R 4.2.0)\n dplyr       * 1.0.99.9000   2022-09-23 [1] Github (tidyverse/dplyr@19c2be3)\n ellipsis      0.3.2         2021-04-29 [1] CRAN (R 4.2.0)\n evaluate      0.16          2022-08-09 [1] CRAN (R 4.2.1)\n extrafont   * 0.18          2022-04-12 [1] CRAN (R 4.2.0)\n extrafontdb   1.0           2012-06-11 [1] CRAN (R 4.2.0)\n fansi         1.0.3         2022-03-24 [1] CRAN (R 4.2.0)\n farver        2.1.1         2022-07-06 [1] CRAN (R 4.2.1)\n fastmap       1.1.0         2021-01-25 [1] CRAN (R 4.2.0)\n forcats     * 0.5.2.9000    2022-08-20 [1] Github (tidyverse/forcats@bd319e0)\n formattable * 0.2.1         2021-01-07 [1] CRAN (R 4.2.1)\n fs            1.5.2.9000    2022-08-24 [1] Github (r-lib/fs@238032f)\n generics      0.1.3         2022-07-05 [1] CRAN (R 4.2.1)\n ggplot2     * 3.3.6.9000    2022-09-12 [1] Github (tidyverse/ggplot2@a58b48c)\n ggrepel       0.9.1         2021-01-15 [1] CRAN (R 4.2.0)\n glue          1.6.2.9000    2022-04-22 [1] Github (tidyverse/glue@d47d6c7)\n gt            0.7.0.9000    2022-09-23 [1] Github (rstudio/gt@4030fb7)\n gtable        0.3.1.9000    2022-09-01 [1] Github (r-lib/gtable@c1a7a81)\n highr         0.9           2021-04-16 [1] CRAN (R 4.2.0)\n hms           1.1.2         2022-08-19 [1] CRAN (R 4.2.1)\n htmltools     0.5.3         2022-07-18 [1] CRAN (R 4.2.1)\n htmlwidgets   1.5.4         2022-08-23 [1] Github (ramnathv/htmlwidgets@400cf1a)\n httpuv        1.6.6         2022-09-08 [1] CRAN (R 4.2.1)\n jsonlite      1.8.0         2022-02-22 [1] CRAN (R 4.2.0)\n knitr         1.40          2022-08-24 [1] CRAN (R 4.2.1)\n labeling      0.4.2         2020-10-20 [1] CRAN (R 4.2.0)\n later         1.3.0         2021-08-18 [1] CRAN (R 4.2.0)\n lattice       0.20-45       2021-09-22 [2] CRAN (R 4.2.1)\n lifecycle     1.0.2.9000    2022-09-23 [1] Github (r-lib/lifecycle@0a6860a)\n lubridate   * 1.8.0.9000    2022-05-24 [1] Github (tidyverse/lubridate@0bb49b2)\n magrittr      2.0.3         2022-03-30 [1] CRAN (R 4.2.0)\n Matrix      * 1.5-1         2022-09-13 [1] CRAN (R 4.2.1)\n memoise       2.0.1         2021-11-26 [1] CRAN (R 4.2.0)\n mime          0.12          2021-09-28 [1] CRAN (R 4.2.0)\n miniUI        0.1.1.1       2018-05-18 [1] CRAN (R 4.2.0)\n munsell       0.5.0         2018-06-12 [1] CRAN (R 4.2.0)\n paletteer     1.4.1.9000    2022-08-16 [1] Github (EmilHvitfeldt/paletteer@aae3e75)\n patchwork   * 1.1.2.9000    2022-08-20 [1] Github (thomasp85/patchwork@c14c960)\n pillar        1.8.1         2022-08-19 [1] CRAN (R 4.2.1)\n pkgbuild      1.3.1         2021-12-20 [1] CRAN (R 4.2.0)\n pkgconfig     2.0.3         2019-09-22 [1] CRAN (R 4.2.0)\n pkgload       1.3.0         2022-06-27 [1] CRAN (R 4.2.1)\n prettyunits   1.1.1.9000    2022-04-22 [1] Github (r-lib/prettyunits@8706d89)\n prismatic     1.1.1         2022-08-15 [1] CRAN (R 4.2.1)\n processx      3.7.0         2022-07-07 [1] CRAN (R 4.2.1)\n profvis       0.3.7         2020-11-02 [1] CRAN (R 4.2.0)\n promises      1.2.0.1       2021-02-11 [1] CRAN (R 4.2.0)\n ps            1.7.1         2022-06-18 [1] CRAN (R 4.2.0)\n purrr       * 0.9000.0.9000 2022-09-23 [1] Github (tidyverse/purrr@7b5578c)\n R.cache       0.16.0        2022-07-21 [1] CRAN (R 4.2.1)\n R.methodsS3   1.8.2         2022-06-13 [1] CRAN (R 4.2.0)\n R.oo          1.25.0        2022-06-12 [1] CRAN (R 4.2.0)\n R.utils       2.12.0        2022-06-28 [1] CRAN (R 4.2.1)\n R6            2.5.1.9000    2022-08-04 [1] Github (r-lib/R6@87d5e45)\n ragg          1.2.2.9000    2022-09-12 [1] Github (r-lib/ragg@904e145)\n Rcpp          1.0.9         2022-07-08 [1] CRAN (R 4.2.1)\n readr       * 2.1.2.9000    2022-09-20 [1] Github (tidyverse/readr@5cac6ed)\n rematch2      2.1.2         2020-05-01 [1] CRAN (R 4.2.0)\n remotes       2.4.2         2022-09-12 [1] Github (r-lib/remotes@bc0949d)\n rlang         1.0.5.9000    2022-09-23 [1] Github (r-lib/rlang@a72c03c)\n rmarkdown     2.16.1        2022-08-25 [1] Github (rstudio/rmarkdown@b8a9879)\n Rttf2pt1      1.3.10        2022-02-07 [1] CRAN (R 4.2.0)\n sass          0.4.2         2022-07-16 [1] CRAN (R 4.2.1)\n scales        1.2.1.9000    2022-08-20 [1] Github (r-lib/scales@b3df2fb)\n sessioninfo   1.2.2         2021-12-06 [1] CRAN (R 4.2.0)\n shiny         1.7.2         2022-07-19 [1] CRAN (R 4.2.1)\n stringi       1.7.8         2022-07-11 [1] CRAN (R 4.2.1)\n stringr     * 1.4.1.9000    2022-08-21 [1] Github (tidyverse/stringr@792bc92)\n styler      * 1.7.0.9002    2022-09-21 [1] Github (r-lib/styler@1f4437b)\n systemfonts   1.0.4         2022-02-11 [1] CRAN (R 4.2.0)\n textshaping   0.3.6         2021-10-13 [1] CRAN (R 4.2.0)\n tibble      * 3.1.8.9001    2022-09-23 [1] Github (tidyverse/tibble@eb132e7)\n tidyr       * 1.2.1.9000    2022-09-09 [1] Github (tidyverse/tidyr@653def2)\n tidyselect    1.1.2.9000    2022-09-21 [1] Github (r-lib/tidyselect@edd0a3b)\n tidyverse   * 1.3.2.9000    2022-09-12 [1] Github (tidyverse/tidyverse@3be8283)\n tzdb          0.3.0         2022-03-28 [1] CRAN (R 4.2.0)\n urlchecker    1.0.1         2021-11-30 [1] CRAN (R 4.2.0)\n usethis       2.1.6.9000    2022-09-23 [1] Github (r-lib/usethis@8ecb7ab)\n utf8          1.2.2         2021-07-24 [1] CRAN (R 4.2.0)\n vctrs         0.4.1.9000    2022-09-19 [1] Github (r-lib/vctrs@0a219ba)\n viridisLite   0.4.1         2022-08-22 [1] CRAN (R 4.2.1)\n vroom         1.5.7.9000    2022-09-09 [1] Github (r-lib/vroom@0c2423e)\n withr         2.5.0         2022-03-03 [1] CRAN (R 4.2.0)\n xfun          0.33          2022-09-12 [1] CRAN (R 4.2.1)\n xtable        1.8-4         2019-04-21 [1] CRAN (R 4.2.0)\n yaml          2.3.5         2022-02-21 [1] CRAN (R 4.2.0)\n\n [1] /opt/homebrew/lib/R/4.2/site-library\n [2] /opt/homebrew/Cellar/r/4.2.1_4/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#preparation",
    "href": "global_reprogramming_of_transcription.html#preparation",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "Preparation",
    "text": "Preparation\n\n\n\nFunctions\n\n\n\nLoad required packages.\n\nlibrary(tidyverse)\nlibrary(Matrix)\nlibrary(patchwork)\nlibrary(extrafont)\n\n\n\n\n\n\n\n\nsource(file = file.path(SCRIPT_DIR, \"utilities.R\"))\n\n\n`%+replace%` <- ggplot2::`%+replace%`\n\nSymbols\n\nPROJECT_DIR <- file.path(\n    \"/Users/jialei/Dropbox/Data/Projects/UTSW/Cellular_reprogramming\",\n    \"Cardiac_reprogramming/Data_submission/Github\"\n)\n\n\ngene_symbols <- vroom::vroom(\n    file = file.path(\n        PROJECT_DIR, \"data\", \"misc\", \"genes.tsv\"\n    ),\n    col_names = FALSE\n)\n\ngene_symbols <- setNames(object = gene_symbols$X2, nm = gene_symbols$X1)\ngene_symbols |> head()\n\nENSMUSG00000051951 ENSMUSG00000089699 ENSMUSG00000102343 ENSMUSG00000025900 \n            \"Xkr4\"           \"Gm1992\"          \"Gm37381\"              \"Rp1\" \nENSMUSG00000109048 ENSMUSG00000025902 \n             \"Rp1\"            \"Sox17\" \n\n\n\nlength(gene_symbols)\n\n[1] 27999\n\n\nMatrix\n\nmatrix_readcount_use <- Matrix::sparseMatrix(\n    i = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_indices.rds\"\n        )\n    ),\n    p = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_indptr.rds\"\n        )\n    ),\n    x = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_values.rds\"\n        )\n    ),\n    dims = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_shape.rds\"\n        )\n    ),\n    dimnames = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/10x\", \"expr_readcount_raw_csc_dimnames.rds\"\n        )\n    ),\n    index1 = FALSE\n)\n\n\ndim(matrix_readcount_use)\n\n[1] 27999 34564\n\n\n\nrownames(matrix_readcount_use) <- paste(\n    rownames(matrix_readcount_use),\n    gene_symbols[rownames(matrix_readcount_use)],\n    sep = \"_\"\n)\n\nmatrix_readcount_use[1:5, 1:5] |>\n    as.matrix() |>\n    knitr::kable()\n\n\n\n\n\n\n\n\n\n\n\n\nBL5_AAACCTGCACTACAGT\nBL5_AAACCTGCAGTACACT\nBL5_AAACCTGGTTCACGGC\nBL5_AAACCTGGTTGCTCCT\nBL5_AAACCTGTCCAACCAA\n\n\n\nENSMUSG00000051951_Xkr4\n0\n0\n0\n0\n0\n\n\nENSMUSG00000089699_Gm1992\n0\n0\n0\n0\n0\n\n\nENSMUSG00000102343_Gm37381\n0\n0\n0\n0\n0\n\n\nENSMUSG00000025900_Rp1\n0\n0\n0\n0\n0\n\n\nENSMUSG00000109048_Rp1\n0\n0\n0\n0\n0\n\n\n\n\n\nCellDataSet\n\nmonocle2_result <- extract_monocle2_result(\n    cell_dataset = readRDS(\n        file = file.path(\n            PROJECT_DIR, \"data/10x/epicardial_3f_d7\",\n            \"cell_dataset_lowerDetectionLimit0.5_DDRTree_dim2_reverse.rds\"\n        )\n    )\n)\n\n\ndim(monocle2_result$data)\n\n[1] 22693    11\n\n\n\nCheck memory usage.\n\npurrr::walk(\n    list(matrix_readcount_use, monocle2_result), \\(x) {\n        print(object.size(x), units = \"auto\", standard = \"SI\")\n    }\n)\n\n1.1 GB\n3.5 MB"
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#trajectory",
    "href": "global_reprogramming_of_transcription.html#trajectory",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "Trajectory",
    "text": "Trajectory\n\n\n\n\nx_column <- \"x_monocle\"\ny_column <- \"y_monocle\"\n\nGEOM_POINT_SIZE <- 0.5\nEMBEDDING_TITLE_PREFIX <- \"Monocle\"\nRASTERISED <- FALSE\n\n\nembedding <- monocle2_result$data |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            category %in% c(\"BL18\") ~ \"10F, D14\",\n            category %in% c(\"BL19\") ~ \"3F, D7\",\n            category %in% c(\"BL5\", \"BL6\") ~ \"Primary\",\n            category %in% c(\"BL7\") ~ \"Uninfected\",\n            category %in% c(\"BL8\") ~ \"10F, D7\"\n        ),\n        group = factor(\n            group,\n            levels = c(\n                \"Primary\", \"Uninfected\",\n                \"10F, D7\", \"10F, D14\", \"3F, D7\"\n            )\n        )\n    ) |>\n    dplyr::rename(cell = sample_name)\n\n\np_embedding_pseudotime <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$pseudotime,\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Pseudotime\"),\n    color_legend = TRUE,\n    sort_values = TRUE\n) +\n    theme_customized_embedding()\n\ncolor_labels <- embedding |>\n    dplyr::group_by(state) |>\n    dplyr::summarise(\n        x = median(x_monocle),\n        y = median(y_monocle)\n    ) |>\n    as.data.frame()\n\ngeom_segment_layer <- ggplot2::geom_segment(\n    ggplot2::aes_string(\n        x = \"source_prin_graph_dim_1\",\n        y = \"source_prin_graph_dim_2\",\n        xend = \"target_prin_graph_dim_1\",\n        yend = \"target_prin_graph_dim_2\"\n    ),\n    data = monocle2_result$edge,\n    na.rm = TRUE,\n    color = \"#2196F3\",\n    linetype = \"solid\",\n    linewidth = .25\n)\n\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0. Please use tidy evaluation\nideoms with `aes()`\n\nlayers <- list(\n    ggplot2::geom_point(\n        data = color_labels,\n        aes(x, y),\n        size = 2.0,\n        stroke = 0,\n        shape = 22,\n        fill = \"#E29C36\",\n        color = \"#E29C36\"\n    ),\n    ggplot2::annotate(\n        geom = \"text\",\n        x = color_labels$x,\n        y = color_labels$y,\n        label = LETTERS[as.integer(color_labels$state)],\n        size = 1.5,\n        family = \"Arial\",\n        color = \"black\"\n    )\n)\n\np_embedding_pseudotime <- p_embedding_pseudotime +\n    geom_segment_layer +\n    layers\n\n\np_embedding_UMI <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = log10(Matrix::colSums(matrix_readcount_use[, embedding$cell])),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; UMI\"),\n    color_legend = TRUE,\n    sort_values = FALSE,\n    shuffle_values = TRUE\n) + theme_customized_embedding() +\n    geom_segment_layer\n\n\np_embedding_backbone <- ggplot2::ggplot() +\n    ggplot2::facet_wrap(NA) +\n    geom_segment_layer +\n    theme_customized_embedding() +\n    scale_x_continuous(\n        limits = extract_ggplot_axis_ranges(p_embedding_pseudotime)[[1]]\n    ) +\n    scale_y_continuous(\n        limits = extract_ggplot_axis_ranges(p_embedding_pseudotime)[[2]]\n    ) +\n    layers\n\n\np_embedding_MT <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = (colSums(matrix_readcount_use[\n        stringr::str_detect(\n            string = stringr::str_remove(\n                string = rownames(matrix_readcount_use),\n                pattern = \"^E.+_\"\n            ),\n            pattern = \"mt-\"\n        ),\n    ]) / colSums(matrix_readcount_use))[embedding$cell],\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; MT %\"),\n    color_legend = TRUE,\n    sort_values = TRUE,\n    shuffle_values = FALSE\n) + theme_customized_embedding() +\n    geom_segment_layer\n\n\nlist(\n    p_embedding_backbone,\n    p_embedding_pseudotime,\n    p_embedding_UMI,\n    p_embedding_MT\n) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2, byrow = TRUE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nCellular state\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(state) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    dplyr::mutate(\n        state = LETTERS[as.integer(state)]\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(state),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(median_umis:median_features),\n        fns = list(\n            Mean = ~ mean(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**Monocle**; Cellular state\")\n    )\n\n\n\n\n\n\n\nMonocle; Cellular state\n    \n\n\n      state\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\nA\n8106\n14130.0\n3644.5\n\n\n\nB\n206\n8527.0\n2717.5\n\n\n\nC\n538\n12166.5\n3373.0\n\n\n\nD\n181\n10272.0\n2977.0\n\n\n\nE\n2380\n12835.5\n3579.5\n\n\n\nF\n965\n7742.0\n2573.0\n\n\n\nG\n1577\n5636.0\n2067.0\n\n\n\nH\n4064\n10072.0\n3018.5\n\n\n\nI\n4676\n4981.5\n1572.0\n\n\nCount\n9\n—\n—\n—\n\n\nMean\n—\n—\n9,596\n2,836\n\n\nSum\n—\n22,693\n—\n—\n\n\n\n\n\n\n\npurrr::map(levels(embedding$state), \\(x) {\n    plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = as.integer(embedding$state == x) |> as.factor(),\n        label = glue::glue(\n            \"{EMBEDDING_TITLE_PREFIX}; Pseudotime; \",\n            \"State {LETTERS[as.integer(x)]}\"\n        ),\n        color_legend = FALSE,\n        sort_values = TRUE\n    ) +\n        theme_customized_embedding() +\n        ggplot2::scale_color_manual(values = c(\"grey70\", \"salmon\")) +\n        geom_segment_layer\n}) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 3, byrow = TRUE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nGroup\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(group) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    dplyr::select(\n        group, dplyr::everything()\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(group),\n        colors = scales::col_factor(\n            palette = paletteer::paletteer_d(\n                n = 5, palette = \"colorblindr::OkabeIto\"\n            ) |> as.character(),\n            domain = NULL\n        )\n    ) |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(group),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(median_umis:median_features),\n        fns = list(\n            Mean = ~ mean(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**Monocle**; Group\")\n    )\n\n\n\n\n\n\n\nMonocle; Group\n    \n\n\n      group\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\nPrimary\n64\n6244.5\n2619.5\n\n\n\nUninfected\n4914\n13713.0\n3571.0\n\n\n\n10F, D7\n5291\n10534.0\n3043.0\n\n\n\n10F, D14\n5639\n9724.0\n2881.0\n\n\n\n3F, D7\n6785\n8805.0\n2812.0\n\n\nCount\n5\n—\n—\n—\n\n\nMean\n—\n—\n9,804\n2,985\n\n\nSum\n—\n22,693\n—\n—\n\n\n\n\n\n\n\nlist(\n    plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = embedding$group,\n        label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Pseudotime; Batch\"),\n        color_legend = TRUE,\n        sort_values = FALSE,\n        shuffle_values = TRUE\n    ) +\n        theme_customized_embedding() +\n        geom_segment_layer,\n    purrr::map(levels(embedding$group), \\(x) {\n        plot_embedding(\n            data = embedding[, c(x_column, y_column)],\n            color = as.integer(embedding$group == x) |> as.factor(),\n            label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Pseudotime; {x}\"),\n            color_legend = FALSE,\n            sort_values = TRUE\n        ) +\n            theme_customized_embedding() +\n            ggplot2::scale_color_manual(values = c(\"grey70\", \"salmon\")) +\n            geom_segment_layer\n    })\n) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2, byrow = TRUE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nComposition\n\ncolor_palette <- setNames(\n    object = c(\"#e37b3e\", \"#44b29c\", \"#de5a49\", \"#f7a8a5\", \"#f0ca4e\"),\n    nm = c(\"Primary\", \"3F, D7\", \"10F, D14\", \"10F, D7\", \"Uninfected\")\n)\n\nscales::show_col(color_palette, borders = NA)\n\n\n\n\n\n\n\n\ncalc_group_composition(\n    data = embedding,\n    x = \"state\",\n    group = \"group\"\n) |>\n    dplyr::mutate(\n        state = factor(\n            LETTERS[as.integer(state)]\n        )\n    ) |>\n    plot_barplot(\n        x = \"state\",\n        y = \"percentage\",\n        z = \"group\",\n        legend_ncol = 1\n    ) +\n    ggplot2::scale_fill_manual(\n        values = color_palette\n    )\n\n\n\n\n\n\n\n\ncalc_group_composition(\n    data = embedding,\n    x = \"state\",\n    group = \"group\"\n) |>\n    dplyr::mutate(\n        group = factor(\n            group,\n            levels = c(\"Primary\", \"3F, D7\", \"10F, D14\", \"10F, D7\", \"Uninfected\")\n        )\n    ) |>\n    split(~state) |>\n    purrr::map(\n        \\(x) {\n            x |>\n                dplyr::mutate(\n                    label_position = cumsum(percentage) - percentage / 2\n                )\n        }\n    ) |>\n    dplyr::bind_rows() |>\n    {\n        \\(x) {\n            ggplot2::ggplot(\n                data = x,\n                aes(\n                    x = \"\",\n                    y = percentage,\n                    fill = group\n                )\n            ) +\n                geom_bar(width = 1, stat = \"identity\") +\n                coord_polar(\"y\", start = 0) +\n                facet_wrap(\n                    ~state,\n                    labeller = labeller(\n                        state = setNames(\n                            object = paste(\n                                \"State\",\n                                LETTERS[as.integer(levels(embedding$state))]\n                            ),\n                            nm = levels(embedding$state)\n                        )\n                    )\n                ) +\n                ggplot2::geom_text(\n                    data = x,\n                    ggplot2::aes(\n                        y = label_position,\n                        label = scales::percent(percentage, accuracy = 0.01)\n                    ), size = 5 / ggplot2::.pt\n                ) +\n                ggplot2::scale_x_discrete(name = NULL) +\n                ggplot2::scale_y_continuous(name = NULL) +\n                ggplot2::scale_fill_manual(\n                    name = NULL,\n                    values = color_palette\n                ) +\n                theme_customized_violin() %+replace%\n                ggplot2::theme(\n                    axis.text.x = ggplot2::element_blank(),\n                    axis.ticks = ggplot2::element_blank(),\n                    legend.text = ggplot2::element_text(\n                        size = 6,\n                        margin = ggplot2::margin(\n                            t = 0, r = 0,\n                            b = 0, l = -1,\n                            unit = \"mm\"\n                        )\n                    ),\n                    legend.key.size = ggplot2::unit(4, \"mm\")\n                )\n        }\n    }()"
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#expression",
    "href": "global_reprogramming_of_transcription.html#expression",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "Expression",
    "text": "Expression\n\nFEATURES_SELECTED <- c(\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\",\n    \"ENSMUSG00000036098_Myrf\",\n    \"ENSMUSG00000042985_Upk3b\"\n)\n\npurrr::map(FEATURES_SELECTED, \\(x) {\n    selected_feature <- x\n\n    cat(selected_feature, \"\\n\")\n    values <- log10(\n        calc_cpm(matrix_readcount_use[, embedding$cell])\n        [selected_feature, ] + 1\n    )\n    values[embedding$group != \"3F, D7\"] <- NA\n\n    plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = values,\n        label = glue::glue(\n            \"{EMBEDDING_TITLE_PREFIX}; 3F, D7; \",\n            \"{x |> stringr::str_remove(pattern = \\\"^E.+_\\\")}\"\n        ),\n        color_legend = TRUE,\n        sort_values = TRUE,\n        na_value = \"grey70\"\n    ) +\n        theme_customized_embedding() +\n        geom_segment_layer\n}) |>\n    # unlist(recursive = FALSE) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2, byrow = FALSE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\nENSMUSG00000016458_Wt1 \nENSMUSG00000025105_Bnc1 \nENSMUSG00000036098_Myrf \nENSMUSG00000042985_Upk3b"
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#enrichment-of-exogenous-factors",
    "href": "global_reprogramming_of_transcription.html#enrichment-of-exogenous-factors",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "Enrichment of exogenous factors",
    "text": "Enrichment of exogenous factors\n\nfeatures_selected_10 <- c(\n    \"ENSMUSG00000026628_Atf3\",\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\",\n    \"ENSMUSG00000051910_Sox6\",\n    \"ENSMUSG00000045680_Tcf21\",\n    \"ENSMUSG00000038193_Hand2\",\n    \"ENSMUSG00000031965_Tbx20\",\n    \"ENSMUSG00000032419_Tbx18\",\n    \"ENSMUSG00000005836_Gata6\",\n    \"ENSMUSG00000036098_Myrf\"\n)\n\n\nstates_selected <- levels(embedding$state)\n\nenriched_factors <- do.call(\n    rbind.data.frame,\n    lapply(states_selected, \\(x) {\n        cells_1 <- embedding$cell[\n            embedding$state == x & embedding$category == \"BL19\"\n        ]\n        cells_2 <- embedding$cell[embedding$category == \"BL7\"]\n\n        cat(x, length(cells_1), length(cells_2), \"\\n\")\n\n        de_paired <- detect_de(\n            cell_group_a = cells_1,\n            cell_group_b = cells_2,\n            matrix_readcount = matrix_readcount_use,\n            matrix_cpm = calc_cpm(matrix_readcount_use),\n            only_enrichment = TRUE\n        ) |>\n            dplyr::mutate(category = x) |>\n            tibble::rownames_to_column(var = \"feature\") |>\n            dplyr::filter(feature %in% features_selected_10)\n    })\n) |>\n    dplyr::filter(category %in% states_selected) |>\n    dplyr::mutate(\n        category = factor(category,\n            levels = states_selected\n        ),\n        symbol = stringr::str_remove(\n            string = feature,\n            pattern = \"^.+_\"\n        )\n    )\n\n1 758 4914 \n2 68 4914 \n3 150 4914 \n4 89 4914 \n5 1092 4914 \n6 585 4914 \n7 998 4914 \n8 2130 4914 \n9 915 4914 \n\n\n\nenriched_factors <- enriched_factors |>\n    dplyr::mutate(\n        pval_adj_log = ifelse(-log10(pval_adj) == Inf, 400, -log10(pval_adj))\n    )\n\nggplot2::ggplot() +\n    ggplot2::geom_abline(intercept = 0, slope = 1, linetype = 2) +\n    ggplot2::geom_point(\n        data = enriched_factors,\n        ggplot2::aes(positive_frac_b,\n            positive_frac_a,\n            size = pval_adj_log, # -log10(pval_adj),\n            color = log2_effect\n        ),\n        alpha = .8,\n        stroke = 0, shape = 16\n    ) +\n    ggplot2::facet_wrap(\n        ~category,\n        ncol = 3,\n        labeller = ggplot2::labeller(\n            category = setNames(\n                object = paste(\"State\", LETTERS[as.integer(states_selected)]),\n                nm = states_selected\n            )\n        )\n    ) +\n    ggplot2::coord_fixed() +\n    ggplot2::scale_color_viridis_c(\n        name = expression(paste(\"Log\"[2], \" effect\"))\n    ) +\n    ggplot2::scale_size_continuous(\n        name = expression(paste(\"-log\"[10], \" (p-value)\"))\n    ) +\n    ggplot2::guides(\n        color = ggplot2::guide_colorbar(order = 1),\n        size = ggplot2::guide_legend(order = 2)\n    ) +\n    ggplot2::scale_x_continuous(\n        name = \"Expr (%, other reprogrammed cells)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    ggplot2::scale_y_continuous(\n        name = \"Expr (%, indicated cluster)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    theme_customized_violin() %+replace%\n    ggplot2::theme(\n        legend.background = ggplot2::element_blank(),\n        legend.margin = ggplot2::margin(t = 0, r = 0, b = 0, l = 0, unit = \"mm\"),\n        legend.key.size = ggplot2::unit(2.5, \"mm\"),\n        legend.text = ggplot2::element_text(family = \"Arial\", size = 6),\n        legend.title = ggplot2::element_text(family = \"Arial\", size = 7),\n        legend.position = \"bottom\",\n        legend.box = \"horizontal\",\n        legend.box.background = ggplot2::element_blank()\n    ) +\n    ggrepel::geom_text_repel(\n        data = enriched_factors,\n        ggplot2::aes(\n            positive_frac_b,\n            positive_frac_a,\n            label = symbol\n        ),\n        #\n        size = 5 / ggplot2::.pt,\n        family = \"Arial\",\n        box.padding = .2,\n        point.padding = .2,\n        nudge_y = .15,\n        arrow = ggplot2::arrow(length = ggplot2::unit(.02, \"npc\")),\n        segment.color = \"grey35\",\n        color = \"black\"\n    )"
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#exploring-gene-regulatory-network",
    "href": "global_reprogramming_of_transcription.html#exploring-gene-regulatory-network",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "Exploring gene regulatory network",
    "text": "Exploring gene regulatory network\n\nmake_groups <- function(x, number_of_members) {\n    y <- seq_along(x)\n    chunks <- split(x, ceiling(y / number_of_members))\n\n    if (length(chunks[[length(chunks)]]) < number_of_members) {\n        chunks[[length(chunks) - 1]] <- c(\n            chunks[[length(chunks) - 1]], chunks[[length(chunks)]]\n        )\n\n        chunks[[length(chunks)]] <- NULL\n    }\n    return(chunks)\n}\n\n\nmonocle_states_selected <- c(\n    1, 2, 4, 6, 8\n)\n\ncells_selected_reprogrammed <- embedding |>\n    dplyr::filter(\n        state %in% monocle_states_selected,\n        !category %in% c(\n            \"BL5\",\n            \"BL6\",\n            \"BL7\"\n        )\n    ) |>\n    dplyr::arrange(pseudotime) |>\n    dplyr::pull(cell)\n\ncells_selected_reference <- embedding |>\n    dplyr::filter(\n        state %in% monocle_states_selected,\n        category %in% c(\"BL5\", \"BL6\")\n    ) |>\n    dplyr::arrange(pseudotime) |>\n    dplyr::pull(cell)\n\nMap(length, list(cells_selected_reprogrammed, cells_selected_reference)) |>\n    unlist()\n\n[1] 9727   64\n\n\n\nfeatures_selected_heatmap <- readRDS(\n    file = file.path(\n        PROJECT_DIR,\n        \"data/10x/epicardial_3f_d7/de_paired_primary_epicardial_uninfected.rds\"\n    )\n) |> rownames()\n\n\n\n\n\n\n\n\n\n\n\nNUM_CELLS_TO_MERGE <- 20\n\nmatrix_heatmap_reprogrammed <- purrr::map(\n    make_groups(cells_selected_reprogrammed, NUM_CELLS_TO_MERGE), \\(x) {\n        Matrix::rowSums(matrix_readcount_use[, x])\n    }\n) |>\n    purrr::reduce(cbind) |>\n    calc_cpm()\n\ncolnames(matrix_heatmap_reprogrammed) <- paste(\n    \"metacell_reprogrammed\",\n    1:ncol(matrix_heatmap_reprogrammed),\n    sep = \"_\"\n)\n\n\nmatrix_heatmap_reference <- purrr::map(\n    make_groups(cells_selected_reference, NUM_CELLS_TO_MERGE), \\(x) {\n        Matrix::rowSums(matrix_readcount_use[, x])\n    }\n) |>\n    purrr::reduce(cbind) |>\n    calc_cpm()\n\nmatrix_heatmap_reference <- purrr::map(\n    make_groups(cells_selected_reference, NUM_CELLS_TO_MERGE), \\(x) {\n        Matrix::rowMeans(calc_cpm(matrix_readcount_use[, x]))\n    }\n) |>\n    purrr::reduce(cbind)\n\ncolnames(matrix_heatmap_reference) <- paste(\n    \"metacell_reference\",\n    1:ncol(matrix_heatmap_reference),\n    sep = \"_\"\n)\n\nExpression signature\n\nmatrix_kmeans <- log10(\n    matrix_heatmap_reprogrammed[features_selected_heatmap, ] + 1\n)\n\npos_frac <- .2\nfeatures_selected_heatmap <- features_selected_heatmap[\n    rowMeans(matrix_kmeans > 0) >= pos_frac\n]\nmatrix_kmeans <- matrix_kmeans[features_selected_heatmap, ]\nmatrix_kmeans <- t(scale(t(matrix_kmeans)))\n\nkmeans_limits <- quantile(matrix_kmeans, c(0.05, 0.95))\nmatrix_kmeans[matrix_kmeans < kmeans_limits[1]] <- kmeans_limits[1]\nmatrix_kmeans[matrix_kmeans > kmeans_limits[2]] <- kmeans_limits[2]\n\nNUM_CENTERS <- 6\nSEED <- 20180706\nset.seed(SEED)\nkmeans_out <- kmeans(\n    matrix_kmeans,\n    NUM_CENTERS,\n    iter.max = 10,\n    nstart = 20\n)\n\n\n\n\n\n# customize numbers of features per group\nnum_features_per_group <- kmeans_out$cluster |>\n    table() |>\n    tibble::enframe() |>\n    dplyr::rename(cluster = name, count = value) |>\n    mutate(\n        x = quantile(seq_len(dim(kmeans_out$centers)[2]), .5),\n        # y = 1,\n        y = 0.7,\n        label = paste(\"n =\", count)\n    ) |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            cluster == 6 ~ \"Signature 1\",\n            cluster == 1 ~ \"Signature 2\",\n            cluster == 3 ~ \"Signature 3\",\n            cluster == 5 ~ \"Signature 4\",\n            cluster == 2 ~ \"Signature 5\",\n            cluster == 4 ~ \"Signature 6\"\n        ),\n        group = factor(group)\n    )\n\n# customize x axis limits\nx_breaks <- quantile(seq_len(dim(kmeans_out$centers)[2]), probs = seq(0, 1, 1))\n\n# draw\np_kmeans <- kmeans_out$centers |>\n    t() |>\n    as.data.frame() |>\n    tibble::rownames_to_column(var = \"metacell\") |>\n    dplyr::mutate(x = 1:n()) |>\n    tidyr::pivot_longer(\n        -c(\"metacell\", \"x\"),\n        names_to = \"cluster\",\n        values_to = \"value\"\n    ) |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            cluster == 6 ~ \"Signature 1\",\n            cluster == 1 ~ \"Signature 2\",\n            cluster == 3 ~ \"Signature 3\",\n            cluster == 5 ~ \"Signature 4\",\n            cluster == 2 ~ \"Signature 5\",\n            cluster == 4 ~ \"Signature 6\"\n        ),\n        group = factor(group)\n    ) |>\n    ggplot2::ggplot(ggplot2::aes(x, value)) +\n    ggplot2::geom_line(size = .2) +\n    ggplot2::facet_wrap(\n        ~group,\n        # scales = \"free_y\",\n        ncol = 3,\n        # strip.position = \"left\",\n        strip.position = \"top\",\n        # labeller = labeller(cluster = facet_labels)\n    ) +\n    ggplot2::scale_x_continuous(\n        name = glue::glue(\n            \"Scaled pseudotime (state \",\n            \"{paste(LETTERS[as.integer(monocle_states_selected)], collapse = \\\"\\\")})\"\n        ),\n        breaks = x_breaks\n    ) +\n    ggplot2::scale_y_continuous(\n        name = \"Scaled expr (Z score)\",\n        limits = c(-1.5, 1.5)\n    ) +\n    ggplot2::geom_text(\n        data = num_features_per_group,\n        ggplot2::aes(x, y, label = label),\n        family = \"Arial\",\n        vjust = -.5,\n        size = 2\n    ) +\n    ggplot2::labs(title = \"Reprogrammed cells\") +\n    theme_customized_violin(\n        panel_border_color = \"black\",\n        strip_background_fill = \"grey80\"\n    ) %+replace%\n    ggplot2::theme(\n        axis.text.x = ggplot2::element_text(\n            family = \"Arial\",\n            angle = 90,\n            vjust = .5,\n            hjust = 1,\n            size = 6\n        ),\n        plot.title = ggplot2::element_text(\n            family = \"Arial\",\n            size = 6,\n            # margin = margin(t = 0, r = 0, b = 0, l = 0, unit = \"mm\"))\n            hjust = .5\n        )\n    )\n\n\ng <- ggplot2::ggplot_gtable(ggplot2::ggplot_build(p_kmeans))\nstript <- which(grepl(\"strip-t\", g$layout$name))\n\ncolors_strip_background_fill <- ggthemes::tableau_color_pal(\"Tableau 10\")(n = NUM_CENTERS)\ncolors_strip_background_fill <- c(\n    colors_strip_background_fill[4:6],\n    colors_strip_background_fill[1:3]\n)\n\nk <- 1\nfor (i in stript) {\n    j <- which(grepl(\"rect\", g$grobs[[i]]$grobs[[1]]$childrenOrder))\n    g$grobs[[i]]$grobs[[1]]$children[[j]]$gp$fill <- colors_strip_background_fill[k]\n    k <- k + 1\n}\ngrid::grid.draw(g)\n\n\n\n\n\n\n\n\n\n\n\n\n\nHeatmap\n\nfeature_clusters <- c(6, 1, 3, 5, 2, 4)\nfeatures_selected_heatmap <- purrr::map(feature_clusters, \\(x) {\n    names(kmeans_out$cluster)[kmeans_out$cluster == x]\n}) |>\n    unlist()\nfeatures_selected_heatmap <- paste(\n    features_selected_heatmap, gene_symbols[features_selected_heatmap],\n    sep = \"_\"\n)\n\n# begin\nmatrix_heatmap <- cbind(\n    matrix_heatmap_reprogrammed,\n    matrix_heatmap_reference\n)\nmatrix_heatmap <- matrix_heatmap[features_selected_heatmap, ]\nmatrix_heatmap <- matrix_heatmap[rowSums(matrix_heatmap) != 0, ]\n\nmatrix_heatmap <- log10(matrix_heatmap + 1)\nmatrix_heatmap <- t(scale(t(matrix_heatmap)))\n\nheatmap_limits <- quantile(matrix_heatmap, c(0.05, 0.95))\nmatrix_heatmap[matrix_heatmap < heatmap_limits[1]] <- heatmap_limits[1]\nmatrix_heatmap[matrix_heatmap > heatmap_limits[2]] <- heatmap_limits[2]\n\n\n# get metacell states\nmetacell_annotation_reprogrammed <- purrr::map_int(\n    make_groups(cells_selected_reprogrammed, NUM_CELLS_TO_MERGE), \\(x) {\n        x |>\n            as.data.frame() |>\n            `colnames<-`(\"cell\") |>\n            dplyr::left_join(\n                embedding |>\n                    dplyr::select(cell, state),\n                by = \"cell\"\n            ) |>\n            dplyr::count(state) |>\n            dplyr::slice(1) |>\n            dplyr::pull(state)\n    }\n)\n\n# create labels for metacells\nanno_labels_tbl_state_reprogrammed <- table(metacell_annotation_reprogrammed) |>\n    tibble::enframe(name = \"group\") |>\n    dplyr::mutate(\n        cum_sum = cumsum(value),\n        position = cum_sum - value / 2\n    )\nanno_labels_state_reprogrammed <- rep(NA, ncol(matrix_heatmap_reprogrammed))\n\nfor (i in seq_len(nrow(anno_labels_tbl_state_reprogrammed))) {\n    anno_labels_state_reprogrammed[\n        anno_labels_tbl_state_reprogrammed[i, \"position\", drop = TRUE] #  - 5\n    ] <- LETTERS[\n        as.integer(anno_labels_tbl_state_reprogrammed[i, \"group\", drop = TRUE])\n    ]\n}\n\n\n# create heatmap column annotation\nha_column_reprogrammed <- ComplexHeatmap::HeatmapAnnotation(\n    #\n    state = ComplexHeatmap::anno_simple(\n        metacell_annotation_reprogrammed,\n        pch = anno_labels_state_reprogrammed,\n        col = setNames(\n            object = scales::hue_pal()(\n                n = length(unique(monocle2_result[[1]]$state))\n            ),\n            nm = sort(unique(monocle2_result[[1]]$state))\n        ),\n        which = \"column\",\n        pt_size = unit(5 / ggplot2::.pt, \"mm\"),\n        pt_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        ),\n        simple_anno_size = unit(1.5, \"mm\")\n    ),\n    #\n    show_annotation_name = TRUE,\n    annotation_label = c(\n        \"State\"\n    ),\n    annotation_name_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 5),\n    annotation_name_side = \"left\"\n)\n\n\n# create heatmap row annotation; left\nha_left <- ComplexHeatmap::HeatmapAnnotation(\n    lineage = ComplexHeatmap::anno_simple(\n        setNames(\n            object = rep(\n                seq_len(NUM_CENTERS),\n                purrr::map_int(feature_clusters, \\(x) {\n                    sum(kmeans_out$cluster == x)\n                })\n            ),\n            nm = features_selected_heatmap\n        ),\n        col = setNames(\n            object = ggthemes::tableau_color_pal(\"Tableau 10\")(n = NUM_CENTERS),\n            nm = seq_len(NUM_CENTERS)\n        ),\n        which = \"row\",\n        pt_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        ),\n        simple_anno_size = unit(1.5, \"mm\")\n    ),\n    which = \"row\",\n    show_annotation_name = FALSE,\n    annotation_label = c(\n        \"Cluster\"\n    ),\n    annotation_name_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 5)\n)\n\n\n# map color\ncol_fun <- circlize::colorRamp2(\n    quantile(\n        c(\n            min(matrix_heatmap),\n            max(matrix_heatmap)\n        ),\n        seq(0, 1, 0.1)\n    ),\n    # viridis::plasma(11)\n    wesanderson::wes_palette(\"Zissou1\", 11, type = \"continuous\")\n)\n\nRASTERISED <- FALSE\n\n# create heatmap\nht_reprogrammed <- ComplexHeatmap::Heatmap(\n    matrix = matrix_heatmap[, colnames(matrix_heatmap_reprogrammed)] |> as.matrix(),\n    rect_gp = grid::gpar(col = NA, lwd = 0),\n    col = col_fun,\n    #\n    row_title_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 6),\n    row_title_rot = 0,\n    column_title_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 6),\n    column_title_rot = 0,\n    #\n    cluster_rows = FALSE,\n    show_row_dend = FALSE,\n    cluster_columns = FALSE,\n    show_column_dend = FALSE,\n    #\n    show_row_names = FALSE,\n    show_column_names = FALSE,\n    #\n    top_annotation = ha_column_reprogrammed,\n    bottom_annotation = NULL,\n    left_annotation = ha_left,\n    right_annotation = NULL,\n    #\n    column_split = factor(\n        rep(\"Reprogrammed\", length(metacell_annotation_reprogrammed))\n    ),\n    column_gap = unit(0, \"mm\"),\n    #\n    show_heatmap_legend = FALSE,\n    heatmap_legend_param = list(\n        title = \"Expr\",\n        title_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 6\n        ),\n        legend_direction = \"vertical\",\n        labels_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        ),\n        legend_height = unit(15, \"mm\"),\n        legend_width = unit(5, \"mm\")\n    ),\n    #\n    use_raster = RASTERISED\n)\n\n\nmetacell_annotation_reference <- rep(\n    x = \"Target\",\n    times = ncol(matrix_heatmap_reference)\n)\n\nha_column_reference <- ComplexHeatmap::HeatmapAnnotation(\n    #\n    state = ComplexHeatmap::anno_simple(\n        metacell_annotation_reference,\n        # pch = anno_labels_state_reprogrammed,\n        col = setNames(\n            object = \"#ed7899\",\n            nm = \"Target\"\n        ),\n        which = \"column\",\n        pt_size = unit(2, \"mm\"),\n        pt_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        ),\n        simple_anno_size = unit(1.5, \"mm\")\n    ),\n    #\n    show_annotation_name = FALSE,\n    annotation_label = c(\n        \"State\"\n    ),\n    annotation_name_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 5),\n    annotation_name_side = \"left\"\n)\n\n\nfeatures_selected_to_mark_right <- c(\n    features_selected_10,\n    \"ENSMUSG00000015627_Gata5\",\n    \"ENSMUSG00000031517_Gpm6a\"\n)\n\nfeatures_selected_to_mark_right <- features_selected_to_mark_right[\n    features_selected_to_mark_right %in% rownames(matrix_heatmap)\n]\n\nfeatures_selected_to_mark_right_idx <- which(\n    rownames(matrix_heatmap) %in% features_selected_to_mark_right\n)\nfeatures_selected_to_mark_right_labels <- rownames(matrix_heatmap)[\n    features_selected_to_mark_right_idx\n] |>\n    stringr::str_remove(\n        pattern = \"^E.+_\"\n    )\n\nha_right <- ComplexHeatmap::rowAnnotation(\n    foo = ComplexHeatmap::anno_mark(\n        at = features_selected_to_mark_right_idx,\n        labels = features_selected_to_mark_right_labels,\n        which = \"row\",\n        side = \"right\",\n        lines_gp = grid::gpar(col = \"grey50\"),\n        labels_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        )\n    )\n)\n\n\nht_reference <- ComplexHeatmap::Heatmap(\n    matrix = matrix_heatmap[, colnames(matrix_heatmap_reference)] |> as.matrix(),\n    rect_gp = grid::gpar(col = NA, lwd = 0),\n    col = col_fun,\n    #\n    row_title_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 6),\n    row_title_rot = 0,\n    column_title_gp = grid::gpar(fontfamily = \"Arial\", fontsize = 6),\n    column_title_rot = 0,\n    #\n    cluster_rows = FALSE,\n    show_row_dend = FALSE,\n    cluster_columns = FALSE,\n    show_column_dend = FALSE,\n    #\n    show_row_names = FALSE,\n    show_column_names = FALSE,\n    #\n    top_annotation = ha_column_reference,\n    bottom_annotation = NULL,\n    right_annotation = ha_right,\n    #\n    column_split = factor(\n        rep(\"Epicardial\", length(metacell_annotation_reference))\n    ),\n    column_gap = unit(0, \"mm\"),\n    #\n    show_heatmap_legend = FALSE,\n    heatmap_legend_param = list(\n        title = \"Expr\",\n        title_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 6\n        ),\n        legend_direction = \"vertical\",\n        labels_gp = grid::gpar(\n            fontfamily = \"Arial\",\n            fontsize = 5\n        ),\n        legend_height = unit(15, \"mm\"),\n        legend_width = unit(5, \"mm\")\n    ),\n    #\n    use_raster = RASTERISED\n)\n\n\n\n\n\n# legend\nlgd_colorbar <- ComplexHeatmap::Legend(\n    col_fun = col_fun,\n    title = \"Expr\",\n    #\n    grid_height = unit(1, \"mm\"),\n    grid_width = unit(2, \"mm\"),\n    legend_height = unit(5, \"mm\"),\n    legend_width = unit(2, \"mm\"),\n    #\n    labels_gp = grid::gpar(\n        fontfamily = \"Arial\",\n        fontsize = 5\n    ),\n    title_gp = grid::gpar(\n        fontfamily = \"Arial\",\n        fontsize = 6\n    )\n)\n\nlgd_signature <- ComplexHeatmap::Legend(\n    title = \"Signature\",\n    labels = seq_len(NUM_CENTERS),\n    legend_gp = grid::gpar(\n        fill = setNames(\n            object = ggthemes::tableau_color_pal(\"Tableau 10\")(n = NUM_CENTERS),\n            nm = seq_len(NUM_CENTERS)\n        )\n    ),\n    #\n    grid_height = unit(1, \"mm\"),\n    grid_width = unit(2.5, \"mm\"),\n    #\n    legend_height = unit(5, \"mm\"),\n    legend_width = unit(2, \"mm\"),\n    #\n    labels_gp = grid::gpar(\n        fontfamily = \"Arial\",\n        fontsize = 5\n    ),\n    title_gp = grid::gpar(\n        fontfamily = \"Arial\",\n        fontsize = 6\n    )\n)\n\npd <- ComplexHeatmap::packLegend(\n    lgd_colorbar,\n    lgd_signature,\n    direction = \"vertical\"\n)\n\n\nComplexHeatmap::draw(\n    ht_reprogrammed + ht_reference,\n    heatmap_legend_list = list(pd),\n    #\n    gap = unit(c(1), \"mm\")\n)\n\n\n\nHeatmap of the six gene-expression signatures. Columns indicate cells ordered by pseudotime (with primary epicardial cells at the far right); rows indicate genes. For visualization purposes, groups of 20 cells are binned."
  },
  {
    "objectID": "global_reprogramming_of_transcription.html#r-session-info",
    "href": "global_reprogramming_of_transcription.html#r-session-info",
    "title": "Global Reprogramming of Transcription by Reprogram-Seq",
    "section": "R session info",
    "text": "R session info\n\ndevtools::session_info()\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23)\n os       macOS Monterey 12.6\n system   aarch64, darwin21.6.0\n ui       unknown\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       America/Chicago\n date     2022-09-24\n pandoc   2.19.2 @ /opt/homebrew/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package        * version       date (UTC) lib source\n Biobase          2.56.0        2022-04-26 [1] Bioconductor\n BiocGenerics     0.42.0        2022-04-26 [1] Bioconductor\n bit              4.0.4         2020-08-04 [1] CRAN (R 4.2.0)\n bit64            4.0.5         2020-08-30 [1] CRAN (R 4.2.0)\n cachem           1.0.6         2021-08-19 [1] CRAN (R 4.2.0)\n Cairo            1.6-0         2022-07-05 [1] CRAN (R 4.2.1)\n callr            3.7.2         2022-08-22 [1] CRAN (R 4.2.1)\n circlize         0.4.15        2022-05-10 [1] CRAN (R 4.2.0)\n cli              3.4.1         2022-09-23 [1] CRAN (R 4.2.1)\n clue             0.3-61        2022-05-30 [1] CRAN (R 4.2.0)\n cluster          2.1.4         2022-08-22 [2] CRAN (R 4.2.1)\n codetools        0.2-18        2020-11-04 [2] CRAN (R 4.2.1)\n colorspace       2.0-3         2022-02-21 [1] CRAN (R 4.2.0)\n combinat         0.0-8         2012-10-29 [1] CRAN (R 4.2.0)\n commonmark       1.8.0         2022-03-09 [1] CRAN (R 4.2.0)\n ComplexHeatmap   2.12.1        2022-08-09 [1] Bioconductor\n crayon           1.5.1         2022-03-26 [1] CRAN (R 4.2.0)\n DDRTree          0.1.5         2017-04-30 [1] CRAN (R 4.2.0)\n devtools         2.4.4.9000    2022-09-23 [1] Github (r-lib/devtools@9e2793a)\n digest           0.6.29        2021-12-01 [1] CRAN (R 4.2.0)\n docopt           0.7.1         2020-06-24 [1] CRAN (R 4.2.0)\n doParallel       1.0.17        2022-02-07 [1] CRAN (R 4.2.0)\n dplyr          * 1.0.99.9000   2022-09-23 [1] Github (tidyverse/dplyr@19c2be3)\n ellipsis         0.3.2         2021-04-29 [1] CRAN (R 4.2.0)\n evaluate         0.16          2022-08-09 [1] CRAN (R 4.2.1)\n extrafont      * 0.18          2022-04-12 [1] CRAN (R 4.2.0)\n extrafontdb      1.0           2012-06-11 [1] CRAN (R 4.2.0)\n fansi            1.0.3         2022-03-24 [1] CRAN (R 4.2.0)\n farver           2.1.1         2022-07-06 [1] CRAN (R 4.2.1)\n fastICA          1.2-3         2021-09-25 [1] CRAN (R 4.2.1)\n fastmap          1.1.0         2021-01-25 [1] CRAN (R 4.2.0)\n forcats        * 0.5.2.9000    2022-08-20 [1] Github (tidyverse/forcats@bd319e0)\n foreach          1.5.2         2022-02-02 [1] CRAN (R 4.2.0)\n fs               1.5.2.9000    2022-08-24 [1] Github (r-lib/fs@238032f)\n generics         0.1.3         2022-07-05 [1] CRAN (R 4.2.1)\n GetoptLong       1.0.5         2020-12-15 [1] CRAN (R 4.2.0)\n ggplot2        * 3.3.6.9000    2022-09-12 [1] Github (tidyverse/ggplot2@a58b48c)\n ggrepel          0.9.1         2021-01-15 [1] CRAN (R 4.2.0)\n ggthemes         4.2.4         2021-01-20 [1] CRAN (R 4.2.0)\n GlobalOptions    0.1.2         2020-06-10 [1] CRAN (R 4.2.0)\n glue             1.6.2.9000    2022-04-22 [1] Github (tidyverse/glue@d47d6c7)\n gridExtra        2.3           2017-09-09 [1] CRAN (R 4.2.0)\n gt               0.7.0.9000    2022-09-23 [1] Github (rstudio/gt@4030fb7)\n gtable           0.3.1.9000    2022-09-01 [1] Github (r-lib/gtable@c1a7a81)\n highr            0.9           2021-04-16 [1] CRAN (R 4.2.0)\n hms              1.1.2         2022-08-19 [1] CRAN (R 4.2.1)\n HSMMSingleCell   1.16.0        2022-04-28 [1] Bioconductor\n htmltools        0.5.3         2022-07-18 [1] CRAN (R 4.2.1)\n htmlwidgets      1.5.4         2022-08-23 [1] Github (ramnathv/htmlwidgets@400cf1a)\n httpuv           1.6.6         2022-09-08 [1] CRAN (R 4.2.1)\n igraph           1.3.5         2022-09-22 [1] CRAN (R 4.2.1)\n IRanges          2.30.1        2022-08-18 [1] Bioconductor\n irlba            2.3.5         2021-12-06 [1] CRAN (R 4.2.1)\n iterators        1.0.14        2022-02-05 [1] CRAN (R 4.2.0)\n jsonlite         1.8.0         2022-02-22 [1] CRAN (R 4.2.0)\n knitr            1.40          2022-08-24 [1] CRAN (R 4.2.1)\n labeling         0.4.2         2020-10-20 [1] CRAN (R 4.2.0)\n later            1.3.0         2021-08-18 [1] CRAN (R 4.2.0)\n lattice          0.20-45       2021-09-22 [2] CRAN (R 4.2.1)\n leidenbase       0.1.11        2022-03-28 [1] CRAN (R 4.2.1)\n lifecycle        1.0.2.9000    2022-09-23 [1] Github (r-lib/lifecycle@0a6860a)\n limma            3.52.3        2022-09-11 [1] Bioconductor\n lubridate      * 1.8.0.9000    2022-05-24 [1] Github (tidyverse/lubridate@0bb49b2)\n magick           2.7.3         2021-08-18 [1] CRAN (R 4.2.0)\n magrittr         2.0.3         2022-03-30 [1] CRAN (R 4.2.0)\n Matrix         * 1.5-1         2022-09-13 [1] CRAN (R 4.2.1)\n matrixStats      0.62.0        2022-04-19 [1] CRAN (R 4.2.0)\n memoise          2.0.1         2021-11-26 [1] CRAN (R 4.2.0)\n mime             0.12          2021-09-28 [1] CRAN (R 4.2.0)\n miniUI           0.1.1.1       2018-05-18 [1] CRAN (R 4.2.0)\n monocle          2.24.1        2022-06-09 [1] Bioconductor\n munsell          0.5.0         2018-06-12 [1] CRAN (R 4.2.0)\n paletteer        1.4.1.9000    2022-08-16 [1] Github (EmilHvitfeldt/paletteer@aae3e75)\n patchwork      * 1.1.2.9000    2022-08-20 [1] Github (thomasp85/patchwork@c14c960)\n pheatmap         1.0.12        2019-01-04 [1] CRAN (R 4.2.0)\n pillar           1.8.1         2022-08-19 [1] CRAN (R 4.2.1)\n pkgbuild         1.3.1         2021-12-20 [1] CRAN (R 4.2.0)\n pkgconfig        2.0.3         2019-09-22 [1] CRAN (R 4.2.0)\n pkgload          1.3.0         2022-06-27 [1] CRAN (R 4.2.1)\n plyr             1.8.7         2022-03-24 [1] CRAN (R 4.2.0)\n png              0.1-7         2013-12-03 [1] CRAN (R 4.2.0)\n prettyunits      1.1.1.9000    2022-04-22 [1] Github (r-lib/prettyunits@8706d89)\n prismatic        1.1.1         2022-08-15 [1] CRAN (R 4.2.1)\n processx         3.7.0         2022-07-07 [1] CRAN (R 4.2.1)\n profvis          0.3.7         2020-11-02 [1] CRAN (R 4.2.0)\n promises         1.2.0.1       2021-02-11 [1] CRAN (R 4.2.0)\n ps               1.7.1         2022-06-18 [1] CRAN (R 4.2.0)\n purrr          * 0.9000.0.9000 2022-09-23 [1] Github (tidyverse/purrr@7b5578c)\n qlcMatrix        0.9.7         2018-04-20 [1] CRAN (R 4.2.0)\n R.cache          0.16.0        2022-07-21 [1] CRAN (R 4.2.1)\n R.methodsS3      1.8.2         2022-06-13 [1] CRAN (R 4.2.0)\n R.oo             1.25.0        2022-06-12 [1] CRAN (R 4.2.0)\n R.utils          2.12.0        2022-06-28 [1] CRAN (R 4.2.1)\n R6               2.5.1.9000    2022-08-04 [1] Github (r-lib/R6@87d5e45)\n ragg             1.2.2.9000    2022-09-12 [1] Github (r-lib/ragg@904e145)\n RANN             2.6.1         2019-01-08 [1] CRAN (R 4.2.0)\n RColorBrewer     1.1-3         2022-04-03 [1] CRAN (R 4.2.0)\n Rcpp             1.0.9         2022-07-08 [1] CRAN (R 4.2.1)\n readr          * 2.1.2.9000    2022-09-20 [1] Github (tidyverse/readr@5cac6ed)\n rematch2         2.1.2         2020-05-01 [1] CRAN (R 4.2.0)\n remotes          2.4.2         2022-09-12 [1] Github (r-lib/remotes@bc0949d)\n reshape2         1.4.4         2020-04-09 [1] CRAN (R 4.2.0)\n rjson            0.2.21        2022-01-09 [1] CRAN (R 4.2.0)\n rlang            1.0.5.9000    2022-09-23 [1] Github (r-lib/rlang@a72c03c)\n rmarkdown        2.16.1        2022-08-25 [1] Github (rstudio/rmarkdown@b8a9879)\n Rtsne            0.16          2022-09-12 [1] Github (jkrijthe/Rtsne@55aad4a)\n Rttf2pt1         1.3.10        2022-02-07 [1] CRAN (R 4.2.0)\n S4Vectors        0.34.0        2022-04-26 [1] Bioconductor\n sass             0.4.2         2022-07-16 [1] CRAN (R 4.2.1)\n scales           1.2.1.9000    2022-08-20 [1] Github (r-lib/scales@b3df2fb)\n sessioninfo      1.2.2         2021-12-06 [1] CRAN (R 4.2.0)\n shape            1.4.6         2021-05-19 [1] CRAN (R 4.2.0)\n shiny            1.7.2         2022-07-19 [1] CRAN (R 4.2.1)\n slam             0.1-50        2022-01-08 [1] CRAN (R 4.2.1)\n sparsesvd        0.2-1         2022-08-23 [1] CRAN (R 4.2.1)\n stringi          1.7.8         2022-07-11 [1] CRAN (R 4.2.1)\n stringr        * 1.4.1.9000    2022-08-21 [1] Github (tidyverse/stringr@792bc92)\n styler         * 1.7.0.9002    2022-09-21 [1] Github (r-lib/styler@1f4437b)\n systemfonts      1.0.4         2022-02-11 [1] CRAN (R 4.2.0)\n textshaping      0.3.6         2021-10-13 [1] CRAN (R 4.2.0)\n tibble         * 3.1.8.9001    2022-09-23 [1] Github (tidyverse/tibble@eb132e7)\n tidyr          * 1.2.1.9000    2022-09-09 [1] Github (tidyverse/tidyr@653def2)\n tidyselect       1.1.2.9000    2022-09-21 [1] Github (r-lib/tidyselect@edd0a3b)\n tidyverse      * 1.3.2.9000    2022-09-12 [1] Github (tidyverse/tidyverse@3be8283)\n tzdb             0.3.0         2022-03-28 [1] CRAN (R 4.2.0)\n urlchecker       1.0.1         2021-11-30 [1] CRAN (R 4.2.0)\n usethis          2.1.6.9000    2022-09-23 [1] Github (r-lib/usethis@8ecb7ab)\n utf8             1.2.2         2021-07-24 [1] CRAN (R 4.2.0)\n vctrs            0.4.1.9000    2022-09-19 [1] Github (r-lib/vctrs@0a219ba)\n VGAM             1.1-7         2022-07-06 [1] CRAN (R 4.2.1)\n viridis          0.6.2         2021-10-13 [1] CRAN (R 4.2.0)\n viridisLite      0.4.1         2022-08-22 [1] CRAN (R 4.2.1)\n vroom            1.5.7.9000    2022-09-09 [1] Github (r-lib/vroom@0c2423e)\n wesanderson      0.3.6.9000    2022-04-22 [1] Github (karthik/wesanderson@2796b59)\n withr            2.5.0         2022-03-03 [1] CRAN (R 4.2.0)\n xfun             0.33          2022-09-12 [1] CRAN (R 4.2.1)\n xtable           1.8-4         2019-04-21 [1] CRAN (R 4.2.0)\n yaml             2.3.5         2022-02-21 [1] CRAN (R 4.2.0)\n\n [1] /opt/homebrew/lib/R/4.2/site-library\n [2] /opt/homebrew/Cellar/r/4.2.1_4/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Rational Reprogramming of Cellular States by Combinatorial Perturbation",
    "section": "",
    "text": "Workflow\n\n\nRational Reprogramming of Cellular States by Combinatorial Perturbation\n\n\n\n\n\n\n Citation\n\nJialei Duan#, Boxun Li#, Minoti Bhakta#, Shiqi Xie, Pei Zhou, Nikhil V. Munshi*, Gary C. Hon* (2019). Rational Reprogramming of Cellular States by Combinatorial Perturbation. Cell Rep. 27, 3486–3499.e6. DOI: 10.1016/j.celrep.2019.05.079"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "from datetime import datetime\ndatetime.today().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n'2022-09-24 02:53:44'"
  },
  {
    "objectID": "unbiased_reprogramming.html#preparation",
    "href": "unbiased_reprogramming.html#preparation",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "Preparation",
    "text": "Preparation\n\n\n\nFunctions\n\n\n\nLoad required packages.\n\nlibrary(tidyverse)\nlibrary(Matrix)\nlibrary(patchwork)\nlibrary(extrafont)\n\n\nsource(file = file.path(SCRIPT_DIR, \"utilities.R\"))\n\n\n`%+replace%` <- ggplot2::`%+replace%`\n\n\n\n\nSymbols\n\nPROJECT_DIR <- file.path(\n    \"/Users/jialei/Dropbox/Data/Projects/UTSW/Cellular_reprogramming\",\n    \"Cardiac_reprogramming/Data_submission/Github\"\n)\n\n\ngene_symbols <- vroom::vroom(\n    file = file.path(\n        PROJECT_DIR, \"data\", \"misc\", \"genes.tsv\"\n    ),\n    col_names = FALSE\n)\n\ngene_symbols <- setNames(object = gene_symbols$X2, nm = gene_symbols$X1)\n\ngene_symbols |> head()\n\nENSMUSG00000051951 ENSMUSG00000089699 ENSMUSG00000102343 ENSMUSG00000025900 \n            \"Xkr4\"           \"Gm1992\"          \"Gm37381\"              \"Rp1\" \nENSMUSG00000109048 ENSMUSG00000025902 \n             \"Rp1\"            \"Sox17\" \n\n\n\nlength(gene_symbols)\n\n[1] 27999\n\n\nMatrix\n\nmatrix_readcount_use <- Matrix::sparseMatrix(\n    i = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/drop-seq\", \"expr_readcount_raw_csc_indices.rds\"\n        )\n    ),\n    p = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/drop-seq\", \"expr_readcount_raw_csc_indptr.rds\"\n        )\n    ),\n    x = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/drop-seq\", \"expr_readcount_raw_csc_values.rds\"\n        )\n    ),\n    dims = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/drop-seq\", \"expr_readcount_raw_csc_shape.rds\"\n        )\n    ),\n    dimnames = readRDS(\n        file.path(\n            PROJECT_DIR, \"data/drop-seq\", \"expr_readcount_raw_csc_dimnames.rds\"\n        )\n    ),\n    index1 = FALSE\n)\n\n\ndim(matrix_readcount_use)\n\n[1] 27999 27416\n\n\n\nrownames(matrix_readcount_use) <- paste(\n    rownames(matrix_readcount_use),\n    gene_symbols[rownames(matrix_readcount_use)],\n    sep = \"_\"\n)\n\nmatrix_readcount_use[1:5, 1:5] |>\n    as.matrix() |>\n    knitr::kable()\n\n\n\n\n\n\n\n\n\n\n\n\nJD126-1-2_TTTCTATATACA.bam\nJD126-1-2_CCTAGAAACCAG.bam\nJD126-1-2_TCATAGTCTATT.bam\nJD126-1-2_ATGACCTTTCCC.bam\nJD126-1-2_CATTAGTGATGG.bam\n\n\n\nENSMUSG00000051951_Xkr4\n0\n0\n0\n0\n0\n\n\nENSMUSG00000089699_Gm1992\n0\n0\n0\n0\n0\n\n\nENSMUSG00000102343_Gm37381\n0\n0\n0\n0\n0\n\n\nENSMUSG00000025900_Rp1\n0\n0\n0\n0\n0\n\n\nENSMUSG00000109048_Rp1\n0\n0\n0\n0\n0\n\n\n\n\n\nEmbedding\n\nembedding <- readRDS(\n    file = file.path(PROJECT_DIR, \"data/drop-seq\", \"tsne_out_coords.rds\")\n)\n\n\ndim(embedding)\n\n[1] 25776     7\n\n\n\nCheck memory usage.\n\npurrr::walk(\n    list(matrix_readcount_use, embedding), \\(x) {\n        print(object.size(x), units = \"auto\", standard = \"SI\")\n    }\n)\n\n751.2 MB\n3.4 MB"
  },
  {
    "objectID": "unbiased_reprogramming.html#clustering",
    "href": "unbiased_reprogramming.html#clustering",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "Clustering",
    "text": "Clustering\n\nx_column <- \"x\"\ny_column <- \"y\"\n\nGEOM_POINT_SIZE <- 0.5\nEMBEDDING_TITLE_PREFIX <- \"t-SNE\"\nRASTERISED <- FALSE\n\nEmbedding\n\nembedding |>\n    tibble::rownames_to_column(var = \"cell\") |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::rename(batch = batch.id) |>\n    dplyr::group_by(batch) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(batch),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells:median_features),\n        fns = list(\n            Mean = ~ mean(.)\n        ),\n        decimals = 2\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**Drop-Seq**; Batch\")\n    ) |>\n    gt::tab_source_note(\n        source_note = gt::md(\n            \"***[Here](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117795)** are the details.*\"\n        )\n    )\n\n\n\n\n\n\n\nDrop-Seq; Batch\n    \n\n\n      batch\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\nJD126-1-2\n335\n3697.0\n1839.0\n\n\n\nJD126A1\n289\n3499.0\n1669.0\n\n\n\nJD126A5\n310\n3575.0\n1759.5\n\n\n\nJD126B\n625\n3604.0\n1733.0\n\n\n\nJD131-A\n418\n1765.0\n1105.0\n\n\n\nJD131-B\n371\n1895.0\n1146.0\n\n\n\nJD131-C\n381\n1894.0\n1168.0\n\n\n\nJD135A\n101\n3203.0\n1521.0\n\n\n\nJD135Y\n222\n1755.5\n1007.0\n\n\n\nJD135Z\n92\n1890.0\n966.5\n\n\n\nJD136A\n172\n2348.5\n1285.5\n\n\n\nJD136B\n269\n1603.0\n975.0\n\n\n\nJD136C\n168\n1140.5\n734.0\n\n\n\nJD136DE\n370\n1042.5\n694.0\n\n\n\nJD136F\n251\n1752.0\n993.0\n\n\n\nJD136G\n500\n1341.5\n827.0\n\n\n\nJD137A\n268\n2796.5\n1410.5\n\n\n\nJD145A1\n269\n3332.0\n1623.0\n\n\n\nJD145A5\n267\n2911.0\n1503.0\n\n\n\nJD145B1\n284\n3531.5\n1704.0\n\n\n\nJD145B5\n287\n1905.0\n1045.0\n\n\n\nJD145C\n169\n2235.0\n1056.0\n\n\n\nJD145D\n187\n1797.0\n941.0\n\n\n\nJD145E\n287\n977.0\n590.0\n\n\n\nJD145F\n103\n533.0\n396.0\n\n\n\nJD146A1\n530\n3210.5\n1555.5\n\n\n\nJD146A5\n549\n4260.0\n1935.0\n\n\n\nJD146B1\n466\n4879.5\n1973.0\n\n\n\nJD146B5\n444\n4035.5\n1828.0\n\n\n\nJD146C1\n452\n5129.5\n2004.5\n\n\n\nJD146C5\n420\n2922.0\n1399.5\n\n\n\nJD149A\n275\n1118.0\n699.0\n\n\n\nJD149B\n251\n823.0\n531.0\n\n\n\nJD149C\n382\n1179.5\n747.5\n\n\n\nJD149D\n365\n1054.0\n688.0\n\n\n\nJD149E\n236\n854.5\n603.0\n\n\n\nJD150-3A\n393\n1486.0\n911.0\n\n\n\nJD150-3B\n345\n1624.0\n1002.0\n\n\n\nJD150-3C\n487\n2110.0\n1190.0\n\n\n\nJD150-4A\n330\n1652.0\n962.0\n\n\n\nJD150-4B\n370\n1476.5\n893.5\n\n\n\nJD150A\n342\n778.5\n487.0\n\n\n\nJD150B\n317\n849.0\n564.0\n\n\n\nJD150C\n346\n1372.0\n888.5\n\n\n\nJD150D\n465\n1081.0\n723.0\n\n\n\nJD164_165\n272\n3324.5\n1935.5\n\n\n\nJD166_167\n204\n6267.5\n3047.0\n\n\n\nJD168A\n252\n11674.5\n4225.0\n\n\n\nJD168B\n240\n4899.5\n2510.5\n\n\n\nJD168C\n182\n14665.5\n4678.5\n\n\n\nJD168_169\n236\n4234.5\n2302.5\n\n\n\nJD169A\n306\n7700.0\n3450.0\n\n\n\nJD169B\n178\n13284.5\n4515.5\n\n\n\nJD169C\n206\n10929.5\n4092.0\n\n\n\nJD170A\n148\n11175.0\n4197.0\n\n\n\nJD170B\n108\n12311.0\n4191.0\n\n\n\nJD170C\n150\n11961.5\n4228.0\n\n\n\nJD170_171\n288\n13620.5\n4505.5\n\n\n\nJD171A\n270\n7281.0\n3207.0\n\n\n\nJD171B\n224\n11545.0\n4211.5\n\n\n\nJD171C\n166\n9291.0\n3673.0\n\n\n\nPZ473\n168\n9368.5\n3888.5\n\n\n\nPZ474\n188\n6470.0\n3116.5\n\n\n\nPZ475\n326\n11516.5\n4077.0\n\n\n\nPZ476\n292\n10177.5\n3943.0\n\n\n\nPZ477\n552\n5562.5\n2731.0\n\n\n\nPZ478\n344\n7171.0\n3283.5\n\n\n\nPZ479\n356\n9106.0\n3655.0\n\n\n\nPZ480\n196\n10180.5\n3878.5\n\n\n\nPZ481\n132\n11876.5\n4161.0\n\n\n\nPZ482\n70\n4286.0\n2213.0\n\n\n\nPZ483\n98\n4452.5\n2233.5\n\n\n\nPZ484\n224\n9902.5\n3863.5\n\n\n\nPZ485\n264\n10482.5\n3963.5\n\n\n\nPZ486\n344\n6220.0\n2901.5\n\n\n\nPZ487\n238\n5281.5\n2571.5\n\n\n\nPZ492\n399\n1618.0\n960.0\n\n\n\nPZ493\n241\n1394.0\n841.0\n\n\n\nPZ496\n344\n7004.5\n3245.0\n\n\n\nPZ497\n208\n9547.0\n3810.5\n\n\n\nPZ580\n472\n8199.5\n3482.5\n\n\n\nPZ581\n360\n6468.0\n3058.5\n\n\n\nPZ582\n214\n9730.5\n3892.5\n\n\n\nPZ583\n120\n10060.5\n3977.0\n\n\n\nPZ584\n190\n14141.5\n4915.0\n\n\n\nPZ585\n152\n15586.5\n4924.0\n\n\n\nPZ586\n292\n4879.0\n2466.5\n\n\n\nPZ587\n204\n11968.5\n4318.5\n\n\n\nPZ588\n110\n24547.5\n5941.0\n\n\n\nPZ589\n110\n11439.0\n3965.5\n\n\n\nPZ590\n94\n17243.5\n5124.5\n\n\n\nPZ660\n148\n2893.5\n1478.0\n\n\n\nPZ661\n136\n2414.5\n1289.5\n\n\nCount\n93\n—\n—\n—\n\n\nSum\n—\n25,776\n—\n—\n\n\nMean\n—\n277.16\n5,734.12\n2,348.55\n\n\n\nHere are the details.\n    \n\n\n\n\n\nembedding <- embedding |>\n    tibble::rownames_to_column(var = \"cell\") |>\n    dplyr::mutate(\n        group = dplyr::case_when(\n            category %in% c(\"JD168\") ~ \"Reprogrammed\",\n            category %in% c(\"JD174\") ~ \"Control\",\n            TRUE ~ \"Primary\"\n        ),\n        group = factor(\n            group,\n            levels = c(\"Primary\", \"Reprogrammed\", \"Control\")\n        )\n    )\n\n\np_embedding_cluster <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$cluster |> as.factor(),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Cluster\"),\n    color_labels = TRUE,\n    color_legend = FALSE,\n    sort_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding()\n\np_embedding_UMI <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = log10(Matrix::colSums(matrix_readcount_use[, embedding$cell])),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; UMI\"),\n    color_legend = TRUE,\n    sort_values = FALSE,\n    shuffle_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding()\n\np_embedding_MT <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = (colSums(matrix_readcount_use[\n        stringr::str_detect(\n            string = stringr::str_remove(\n                string = rownames(matrix_readcount_use),\n                pattern = \"^E.+_\"\n            ),\n            pattern = \"mt-\"\n        ),\n    ]) / colSums(matrix_readcount_use))[embedding$cell],\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; MT %\"),\n    color_legend = TRUE,\n    sort_values = TRUE,\n    shuffle_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) + theme_customized_embedding()\n\np_embedding_group <- plot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding$group |> as.factor(),\n    label = glue::glue(\"{EMBEDDING_TITLE_PREFIX}; Group\"),\n    color_labels = FALSE,\n    color_legend = TRUE,\n    sort_values = FALSE,\n    shuffle_values = TRUE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding() +\n    ggplot2::scale_color_manual(\n        values = c(\n            Primary = \"#00AFBB\",\n            Reprogrammed = \"#8BC34A\",\n            Control = \"#E7B800\"\n        )\n    )\n\n\n\n\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(cluster) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    gt::gt() |>\n    gt::data_color(\n        columns = c(median_umis),\n        colors = scales::col_numeric(\n            palette = c(\n                \"green\", \"orange\", \"red\"\n            ),\n            domain = NULL\n        )\n    ) |>\n    gt::summary_rows(\n        columns = c(cluster),\n        fns = list(\n            Count = ~ n()\n        ),\n        decimals = 0\n    ) |>\n    gt::summary_rows(\n        columns = c(num_cells),\n        fns = list(\n            Sum = ~ sum(.)\n        ),\n        decimals = 0\n    ) |>\n    gt::tab_header(\n        title = gt::md(\"**Drop-Seq**; Clustering\")\n    )\n\n\n\n\n\n\n\nDrop-Seq; Clustering\n    \n\n\n      cluster\n      num_cells\n      median_umis\n      median_features\n    \n\n\n\n1\n2875\n13196.0\n4578.0\n\n\n\n2\n2798\n8594.0\n3639.5\n\n\n\n3\n2786\n6165.0\n2905.0\n\n\n\n4\n2710\n933.0\n561.5\n\n\n\n5\n2356\n1505.5\n1013.0\n\n\n\n6\n2139\n2590.0\n1249.0\n\n\n\n7\n1934\n2238.5\n1347.0\n\n\n\n8\n1575\n5225.0\n1891.0\n\n\n\n9\n1075\n5719.0\n2203.0\n\n\n\n10\n871\n12955.0\n4294.0\n\n\n\n11\n708\n4111.0\n1872.5\n\n\n\n12\n681\n3495.0\n1956.0\n\n\n\n13\n669\n2438.0\n1483.0\n\n\n\n14\n556\n725.0\n530.5\n\n\n\n15\n478\n2661.0\n1606.5\n\n\n\n16\n474\n1368.0\n906.5\n\n\n\n17\n254\n4995.5\n2172.5\n\n\n\n18\n236\n1737.0\n256.5\n\n\n\n19\n181\n620.0\n372.0\n\n\n\n20\n165\n9490.0\n3679.0\n\n\n\n21\n133\n5234.0\n2464.0\n\n\n\n22\n122\n6274.0\n2877.0\n\n\nCount\n22\n—\n—\n—\n\n\nSum\n—\n25,776\n—\n—\n\n\n\n\n\n\n\n\n\n\npurrr::reduce(\n    list(\n        p_embedding_cluster,\n        p_embedding_UMI,\n        p_embedding_MT,\n        p_embedding_group\n    ),\n    `+`\n) +\n    patchwork::plot_layout(ncol = 2) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\n\n\n\n\nlibrary(formattable)\n\n\nAttaching package: 'formattable'\n\n\nThe following object is masked from 'package:patchwork':\n\n    area\n\nembedding |>\n    dplyr::mutate(\n        num_umis = colSums(matrix_readcount_use[, cell]),\n        num_features = colSums(matrix_readcount_use[, cell] > 0),\n    ) |>\n    dplyr::group_by(group) |>\n    dplyr::summarise(\n        num_cells = n(),\n        median_umis = median(num_umis),\n        median_features = median(num_features)\n    ) |>\n    formattable::formattable(\n        list(\n            # num_cells = formattable::color_tile(\"transparent\", \"lightpink\"),\n            num_cells = formattable::color_bar(\"Lightpink\"),\n            median_umis = formattable::color_bar(\"lightgreen\"),\n            median_features = formattable::color_bar(\"lightblue\")\n        ),\n        full_width = FALSE,\n        caption = \"Drop-Seq; Group\"\n    )\n\n\n\n\nDrop-Seq; Group\n\n\n\ngroup\n\n\nnum_cells\n\n\nmedian_umis\n\n\nmedian_features\n\n\n\n\n\nPrimary\n\n\n15684\n\n\n2030\n\n\n1139\n\n\n\n\nReprogrammed\n\n\n8730\n\n\n8532\n\n\n3562\n\n\n\n\nControl\n\n\n1362\n\n\n9383\n\n\n3789\n\n\n\n\n\n\n\n## | column: body-outset\n\npurrr::map(levels(embedding$group), \\(x) {\n    plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = as.integer(embedding$group == x) |> as.factor(),\n        label = glue::glue(\n            \"{EMBEDDING_TITLE_PREFIX}; {x}: {sum(embedding$group == x)}\"\n        ),\n        color_labels = FALSE,\n        color_legend = FALSE,\n        sort_values = TRUE,\n        shuffle_values = FALSE,\n        rasterise = RASTERISED,\n        geom_point_size = GEOM_POINT_SIZE\n    ) +\n        theme_customized_embedding() +\n        ggplot2::scale_color_manual(\n            values = c(\"grey70\", \"salmon\")\n        )\n}) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 3) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\n\n\n\n\n\n\nExtract colors from the initial plots to keep colors consistent.\n\ncolor_palette <- ggplot2::ggplot_build(p_embedding_cluster)$data[[1]] |>\n    dplyr::select(color = colour, cluster = group) |>\n    unique() |>\n    dplyr::arrange(cluster)\n\ncolor_palette <- setNames(\n    object = color_palette$color,\n    nm = color_palette$cluster\n)\n\nscales::show_col(color_palette, borders = NA)\n\n\n\n\n\n\n\n\ncell_type_segments <- data.frame(\n    x = c(\n        -40, -40, -40, -40, -69, -35, 40, 40, 40, 65, 28, -12, -57.5,\n        -57.5, -57.5\n    ),\n    y = c(\n        60, 60, 60, 60, 20, -55, -70, -70, -70, 50, 55, 65, -52.5,\n        -52.5, -52.5\n    ),\n    xend = c(\n        -30, -44, -60, -30, -69, -35, 32, 0, 40, 65, 35, -20, -17.5,\n        -53, -37.5\n    ),\n    yend = c(\n        35, 15, -5, -22, 35, -65, -58, -66, -45, 36, 60, 70, -25,\n        -45, -47.5\n    ),\n    cluster = c(4, 6, 9, 11, 8, 12, 7, 13, 14, 16, 5, 15, 2, 20, 12)\n)\n\ncell_type_labels <- data.frame(\n    x = c(-40, -61.5, -43, 52, 56, 46, -22, -58),\n    y = c(65, 45, -70, -70, 55, 64, 75, -58),\n    label = c(\n        \"Atrial myocytes\",\n        \"Ventricular\\nmyocytes\",\n        \"Epicardial cells\",\n        \"Fibroblasts\",\n        \"Lymphocytes\",\n        \"Endothelial cells\",\n        \"Macrophages\",\n        \"MEF-derived\"\n    )\n)\n\ncluster_labels <- embedding |>\n    dplyr::group_by(cluster) |>\n    dplyr::summarise(\n        x = median(x),\n        y = median(y)\n    ) |>\n    as.data.frame()\n\nplot_embedding(\n    data = embedding[, c(x_column, y_column)],\n    color = embedding |>\n        dplyr::mutate(\n            color_group = dplyr::case_when(\n                group %in% c(\"Reprogrammed\", \"Control\") ~ \"MEF-derived\",\n                TRUE ~ as.character(cluster)\n            )\n        ) |>\n        dplyr::pull(color_group) |> as.factor(),\n    label = NULL,\n    color_labels = FALSE,\n    color_legend = FALSE,\n    sort_values = FALSE,\n    rasterise = RASTERISED,\n    geom_point_size = GEOM_POINT_SIZE\n) +\n    theme_customized_embedding(void = TRUE) +\n    ggplot2::scale_color_manual(\n        values = c(color_palette, \"MEF-derived\" = \"salmon\")\n    ) +\n    ggplot2::geom_segment(\n        data = cell_type_segments,\n        ggplot2::aes(x = x, xend = xend, y = y, yend = yend),\n        color = \"grey50\",\n        size = .2\n    ) +\n    ggplot2::geom_text(\n        data = cell_type_labels,\n        ggplot2::aes(x, y, label = label),\n        color = c(rep(\"black\", 2), \"#00BFC4\", rep(\"black\", 4), \"#FF5722\"),\n        size = 2.8,\n        family = \"Arial\"\n    ) +\n    ggplot2::annotate(\n        geom = \"text\",\n        family = \"Arial\",\n        x = cluster_labels[, \"x\"],\n        y = cluster_labels[, \"y\"], label = cluster_labels[, 1],\n        parse = TRUE,\n        size = 2,\n        color = c(\"black\")\n    )\n\n\n\n\n\n\npdf_width <- 104\npdf_height <- 74\nfile_name <- glue::glue(\n    \"Rplot_embedding_dropseq_{EMBEDDING_TITLE_PREFIX}_\",\n    \"cell_group_{pdf_width}_{pdf_height}.pdf\"\n)\nif (!file.exists(file_name)) {\n    ggplot2::ggsave(\n        filename = file_name,\n        useDingbats = FALSE,\n        plot = ggplot2::last_plot(),\n        device = NULL,\n        path = NULL,\n        scale = 1,\n        width = pdf_width,\n        height = pdf_height,\n        units = c(\"mm\"),\n    )\n}\n\nComposition\nBar charts indicating the cellar composition of t-SNE clusters defined in Figure 1B.\n\ncalc_group_composition(\n    data = embedding,\n    x = \"cluster\",\n    group = \"group\"\n) |>\n    dplyr::mutate(\n        cluster = factor(\n            cluster,\n            levels = c(\n                19, 18,\n                9, 6, 11, 4, 8, 21,\n                3, 1, 2, 10, 17, 22, 20,\n                13, 7, 14, 12, 15, 5, 16\n            )\n        )\n    ) |>\n    plot_barplot(\n        x = \"cluster\",\n        y = \"percentage\",\n        z = \"group\",\n        legend_ncol = 1\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            Primary = \"#00AFBB\",\n            Reprogrammed = \"#8BC34A\",\n            Control = \"#E7B800\"\n        )\n    )"
  },
  {
    "objectID": "unbiased_reprogramming.html#expression",
    "href": "unbiased_reprogramming.html#expression",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "Expression",
    "text": "Expression\nEmbedding\n\nFEATURES_SELECTED <- c(\n    \"ENSMUSG00000009471_Myod1\",\n    \"ENSMUSG00000026414_Tnnt2\",\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\",\n    \"ENSMUSG00000049382_Krt8\",\n    \"ENSMUSG00000079018_Ly6c1\",\n    \"ENSMUSG00000049436_Upk1b\",\n    \"ENSMUSG00000021391_Cenpp\"\n)\n\n\npurrr::map(FEATURES_SELECTED, \\(x) {\n    selected_feature <- x\n\n    cat(selected_feature, \"\\n\")\n    values <- log10(\n        calc_cpm(matrix_readcount_use[, embedding$cell])\n        [selected_feature, ] + 1\n    )\n\n    p1 <- plot_embedding(\n        data = embedding[, c(x_column, y_column)],\n        color = values,\n        label = paste(\n            EMBEDDING_TITLE_PREFIX,\n            selected_feature |> stringr::str_remove(pattern = \"^E.+_\"),\n            sep = \"; \"\n        ),\n        color_legend = TRUE,\n        sort_values = TRUE,\n        rasterise = RASTERISED,\n        geom_point_size = GEOM_POINT_SIZE * 1.25,\n        na_value = \"grey80\"\n    ) +\n        theme_customized_embedding()\n\n    return(p1)\n}) |>\n    # unlist(recursive = FALSE) |>\n    purrr::reduce(`+`) +\n    patchwork::plot_layout(ncol = 2, byrow = FALSE) +\n    patchwork::plot_annotation(\n        theme = ggplot2::theme(plot.margin = ggplot2::margin())\n    )\n\nENSMUSG00000009471_Myod1 \nENSMUSG00000026414_Tnnt2 \nENSMUSG00000016458_Wt1 \nENSMUSG00000025105_Bnc1 \nENSMUSG00000049382_Krt8 \nENSMUSG00000079018_Ly6c1 \nENSMUSG00000049436_Upk1b \nENSMUSG00000021391_Cenpp \n\n\n\n\n\n\n\n\nViolin\nViolin plot illustrating the expression of cardiac markers from single-cell expression data derived from P0 mouse heart and reprogrammed/uninfected MEFs.\n\n\n\n\nlabels_y <- c(\n    19, 18,\n    9, 6, 11, 4, 8, 21,\n    3, 1, 2, 10, 17, 22, 20,\n    13, 7, 14, 12, 15, 5, 16\n)\n\nplot_violin(\n    cells = embedding |>\n        dplyr::mutate(\n            cluster = factor(\n                cluster,\n                levels = labels_y\n            )\n        ) |>\n        split(~cluster) |>\n        purrr::map(\\(x) {\n            x |> dplyr::pull(cell)\n        }),\n    features = c(\n        \"ENSMUSG00000026414_Tnnt2\",\n        \"ENSMUSG00000013936_Myl2\",\n        \"ENSMUSG00000042045_Sln\",\n        \"ENSMUSG00000001506_Col1a1\",\n        \"ENSMUSG00000005836_Gata6\",\n        \"ENSMUSG00000005583_Mef2c\"\n    ),\n    matrix_cpm = calc_cpm(matrix_readcount_use)\n) +\n    theme_customized_violin(\n        axis_text_color_y = rev(color_palette[as.character(labels_y)])\n    ) +\n    ggplot2::scale_fill_manual(\n        values = color_palette[as.character(labels_y)]\n    ) +\n    ggplot2::scale_color_manual(\n        values = color_palette[as.character(labels_y)]\n    )\n\n\n\n\n\n\n\nBar plot\n\n\n\n\n\n\n\nbarplot_helper <- function(cells, features, matrix_readcount) {\n    purrr::map(names(cells), \\(x) {\n        calc_cpm(matrix_readcount)[\n            features,\n            colnames(matrix_readcount) %in% cells[[x]]\n        ] |>\n            Matrix::rowMeans() |>\n            tibble::enframe(name = \"feature\") |>\n            dplyr::mutate(group = x)\n    }) |>\n        dplyr::bind_rows()\n}\n\nExpression of Myod1 in MEF-derived cells.\n\ncells_barplot <- list(\n    embedding |>\n        dplyr::filter(\n            cluster == 20 & category %in% (\"JD168\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            cluster != 20 & category %in% (\"JD168\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            category %in% (\"JD174\")\n        ) |>\n        dplyr::pull(cell)\n)\nnames(cells_barplot) <- c(\"Cluster 20\", \"Other\", \"Uninfected\")\n\nfeatures_barplot <- c(\n    \"ENSMUSG00000009471_Myod1\",\n    \"ENSMUSG00000016458_Wt1\",\n    \"ENSMUSG00000025105_Bnc1\"\n)\n\nbarplot_helper(cells_barplot, features_barplot, matrix_readcount_use) |>\n    dplyr::filter(feature == \"ENSMUSG00000009471_Myod1\") |>\n    dplyr::mutate(\n        feature = stringr::str_remove(string = feature, pattern = \"^.+_\")\n    ) |>\n    dplyr::mutate(value = log10(value + 1)) |>\n    plot_barplot_simple(\n        x = \"group\",\n        y = \"value\",\n        z = \"feature\",\n        y_title = expression(\"Avg expr; log\"[10] * \" (CPM + 1)\")\n    ) +\n    theme_customized_violin(\n        strip_background_fill = \"grey80\",\n        panel_border_color = \"black\",\n        axis_text_x_angle = c(90, 1, 0.5)\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            c(\n                \"#FF5722\",\n                \"grey35\",\n                \"grey35\"\n            )\n        )\n    )\n\n\n\n\n\n\n\nExpression of Wt1 and Bnc1 in MEF-derived cells.\n\ncells_barplot <- list(\n    embedding |>\n        dplyr::filter(\n            cluster == 12,\n            !category %in% c(\"JD168\", \"JD174\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            cluster == 12 & category %in% (\"JD168\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            cluster != 12 & category %in% (\"JD168\")\n        ) |>\n        dplyr::pull(cell),\n    embedding |>\n        dplyr::filter(\n            category %in% (\"JD174\")\n        ) |>\n        dplyr::pull(cell)\n)\nnames(cells_barplot) <- c(\"Primarry epi.\", \"Cluster 12\", \"Other\", \"Uninfected\")\n\nbarplot_helper(cells_barplot, features_barplot, matrix_readcount_use) |>\n    dplyr::filter(feature != \"ENSMUSG00000009471_Myod1\") |>\n    dplyr::mutate(\n        feature = stringr::str_remove(string = feature, pattern = \"^.+_\"),\n        feature = factor(\n            feature,\n            levels = c(\"Wt1\", \"Bnc1\")\n        )\n    ) |>\n    dplyr::mutate(\n        value = log10(value + 1),\n        group = factor(\n            group,\n            levels = names(cells_barplot)\n        )\n    ) |>\n    plot_barplot_simple(\n        x = \"group\",\n        y = \"value\",\n        z = \"feature\",\n        y_title = expression(\"Avg expr; log\"[10] * \" (CPM + 1)\")\n    ) +\n    theme_customized_violin(\n        strip_background_fill = \"grey80\",\n        panel_border_color = \"black\",\n        axis_text_x_angle = c(90, 1, 0.5)\n    ) +\n    ggplot2::scale_fill_manual(\n        values = c(\n            c(\n                \"#00BFC4\",\n                \"#FF5722\",\n                \"grey35\",\n                \"grey35\"\n            )\n        )\n    )\n\n\n\n\n\n\n\nLollipop\n\n\n\n10 TFs differentially expressed in primary epicardial cells compared with uninfected MEFs. Shown is the expression of 10F in MEFs and P0 mouse heart cells.\n\ncells_lollipop <- embedding |>\n    dplyr::filter(\n        !cluster %in% c(1, 2, 3, 10, 17, 20, 22),\n        !category %in% c(\"JD168\", \"JD174\")\n    ) |>\n    split(~cluster) |>\n    purrr::map(\\(x) {\n        x |> dplyr::pull(cell)\n    })\n\ncells_lollipop <- cells_lollipop[\n    purrr::map_lgl(cells_lollipop, \\(x) length(x) > 0)\n]\n\ncells_lollipop$control <- embedding |>\n    dplyr::filter(category %in% c(\"JD168\", \"JD174\")) |>\n    dplyr::pull(cell)\n\n\nlabels_y <- c(\n    \"12\", \"control\", \"19\", \"18\", \"9\", \"6\", \"11\", \"4\", \"8\",\n    \"21\", \"13\", \"7\", \"14\", \"15\", \"5\", \"16\"\n)\n\n\n\n\n\nplot_lollipop(\n    cells = cells_lollipop[labels_y],\n    features = c(\n        \"ENSMUSG00000026628_Atf3\",\n        \"ENSMUSG00000016458_Wt1\",\n        \"ENSMUSG00000025105_Bnc1\",\n        \"ENSMUSG00000051910_Sox6\",\n        \"ENSMUSG00000045680_Tcf21\",\n        \"ENSMUSG00000038193_Hand2\",\n        \"ENSMUSG00000031965_Tbx20\",\n        \"ENSMUSG00000032419_Tbx18\",\n        \"ENSMUSG00000005836_Gata6\",\n        \"ENSMUSG00000036098_Myrf\"\n    ),\n    matrix_cpm = calc_cpm(matrix_readcount_use)\n) +\n    ggplot2::scale_y_discrete(\n        name = NULL,\n        labels = c(\n            \"Epicardial cell\",\n            \"Uninfected MEF\",\n            \"CM 2\",\n            \"CM 1\",\n            \"Atrial CM\",\n            \"Atrial CM\",\n            \"Atrial CM\",\n            \"Atrial CM\",\n            \"Ventricular CM\",\n            \"CM 3\",\n            \"Cardiac fibroblast\",\n            \"Cardiac fibroblast\",\n            \"Cardiac fibroblast\",\n            \"Macrophage\",\n            \"Endothelial cell\",\n            \"Lymphocyte\"\n        ) |> rev()\n    ) +\n    theme_customized_violin(\n        axis_text_x_angle = c(-45, 1, 0.5),\n        axis_text_color_y = c(color_palette, control = \"grey35\")[rev(labels_y)],\n        panel_grid_major = TRUE\n    ) %+replace%\n    ggplot2::theme(\n        legend.margin = ggplot2::margin(\n            t = 0, r = 0, b = 0, l = 0, unit = \"mm\"\n        ),\n        legend.key.size = ggplot2::unit(2.5, \"mm\"),\n        legend.key.width = ggplot2::unit(4.0, \"mm\"),\n        legend.text = ggplot2::element_text(family = \"Arial\", size = 5),\n        legend.title = ggplot2::element_text(family = \"Arial\", size = 6),\n        legend.position = \"bottom\",\n        legend.box = \"vertical\" # \"horizontal\"\n    ) +\n    ggplot2::scale_size(\n        name = \"% cells expressing gene\",\n        breaks = seq(0, 1, .2),\n        labels = seq(0, 1, .2) * 100,\n        limits = c(0, 1),\n        range = c(0, 6),\n        guide = ggplot2::guide_legend(\n            title.position = \"top\",\n            title.hjust = 0.5,\n            label.position = \"bottom\",\n            nrow = 1,\n            byrow = TRUE,\n            order = 1\n        )\n    ) +\n    ggplot2::scale_color_viridis_c(\n        name = expression(paste(\"Avg expr; log\"[10], \"( CPM + 1)\")),\n        guide = ggplot2::guide_colourbar(\n            title.position = \"top\",\n            title.hjust = 1,\n            barwidth = 5,\n            barheight = 0.6,\n            direction = \"horizontal\",\n            order = 2\n        )\n    )"
  },
  {
    "objectID": "unbiased_reprogramming.html#gene-ontology-enrichment",
    "href": "unbiased_reprogramming.html#gene-ontology-enrichment",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "Gene Ontology enrichment",
    "text": "Gene Ontology enrichment\nGene ontology analysis for genes highly expressed in Cluster 20.\n\nsuppressPackageStartupMessages(library(topGO))\n\n\ngroupGOTerms:   GOBPTerm, GOMFTerm, GOCCTerm environments built.\n\npackageVersion(\"topGO\")\n\n[1] '2.48.0'\n\npackageVersion(\"org.Mm.eg.db\")\n\n[1] '3.15.0'\n\n\n\nde_paired <- detect_de(\n    cell_group_a = embedding |>\n        dplyr::filter(\n            category == \"JD168\",\n            cluster == 20\n        ) |>\n        dplyr::pull(cell),\n    cell_group_b = embedding |>\n        dplyr::filter(\n            category == \"JD168\",\n            cluster != 20\n        ) |>\n        dplyr::pull(cell),\n    matrix_readcount = matrix_readcount_use,\n    matrix_cpm = calc_cpm(matrix_readcount_use)\n    # only_enrichment = TRUE\n)\n\nde_paired |> head()\n\n                           log2_effect          pval positive_frac_a\nENSMUSG00000037139_Myom3      8.166286 3.152517e-219           0.604\nENSMUSG00000079588_Tmem182    8.050808 5.009801e-140           0.402\nENSMUSG00000026251_Chrnd      7.992256  5.311037e-81           0.238\nENSMUSG00000087591_Gm14635    7.975343 2.164927e-110           0.323\nENSMUSG00000101680_Gm29015    7.963194  4.971533e-89           0.262\nENSMUSG00000102717_Gm37759    7.876779 1.253173e-149           0.439\n                           positive_frac_b norm_reads_mean_a norm_reads_mean_b\nENSMUSG00000037139_Myom3             0.002         1.5196756      0.0018586658\nENSMUSG00000079588_Tmem182           0.002         0.8570739      0.0008143528\nENSMUSG00000026251_Chrnd             0.001         0.2803849      0.0004863366\nENSMUSG00000087591_Gm14635           0.001         0.6266815      0.0006813209\nENSMUSG00000101680_Gm29015           0.001         0.4385369      0.0020254669\nENSMUSG00000102717_Gm37759           0.002         0.7279072      0.0018620079\n                           log2_fc_norm_reads cpm_meam_a cpm_meam_b log2_fc_cpm\nENSMUSG00000037139_Myom3             7.011140  177.63879 0.21767902    9.607811\nENSMUSG00000079588_Tmem182           6.325136  100.13546 0.09540360    9.891957\nENSMUSG00000026251_Chrnd             4.791384   32.73270 0.05698473    8.933125\nENSMUSG00000087591_Gm14635           5.897410   73.21501 0.07976347    9.671992\nENSMUSG00000101680_Gm29015           5.221062   51.29588 0.23699159    7.698518\nENSMUSG00000102717_Gm37759           5.959019   85.12481 0.21819530    8.543336\n                                pval_adj\nENSMUSG00000037139_Myom3   6.067921e-219\nENSMUSG00000079588_Tmem182 8.772996e-140\nENSMUSG00000026251_Chrnd    8.352273e-81\nENSMUSG00000087591_Gm14635 3.606077e-110\nENSMUSG00000101680_Gm29015  7.951628e-89\nENSMUSG00000102717_Gm37759 2.229182e-149\n\n\n\ndim(de_paired)\n\n[1] 1126   11\n\n\n\ngenes_of_interest <- rownames(subset(de_paired, log2_effect > 0))\ngene_universe <- rownames(matrix_readcount_use)\ngenes_formatted <- factor(as.integer(gene_universe %in% genes_of_interest))\nnames(genes_formatted) <- gene_universe\nnames(genes_formatted) <- names(genes_formatted) |>\n    stringr::str_remove(pattern = \"_.+$\")\n\ntopgo_data <- new(\n    \"topGOdata\",\n    ontology = \"BP\",\n    allGenes = genes_formatted,\n    annot = annFUN.org,\n    mapping = \"org.Mm.eg.db\",\n    ID = \"Ensembl\"\n)\n## \n## Building most specific GOs .....\n## Loading required package: org.Mm.eg.db\n## \n##  ( 12572 GO terms found. )\n## \n## Build GO DAG topology ..........\n##  ( 15958 GO terms and 36406 relations. )\n## \n## Annotating nodes ...............\n##  ( 21155 genes annotated to the GO terms. )\n\ntopgo_out_classic_fisher <- topGO::runTest(\n    topgo_data,\n    algorithm = \"classic\",\n    statistic = \"fisher\"\n)\n## \n##           -- Classic Algorithm -- \n## \n##       the algorithm is scoring 5220 nontrivial nodes\n##       parameters: \n##           test statistic: fisher\n\n\nNUM_GO_TERMS <- 15\n\n# prepare data\nenriched_gos <- topGO::GenTable(topgo_data,\n    classicFisher = topgo_out_classic_fisher,\n    topNodes = NUM_GO_TERMS\n) |>\n    dplyr::mutate(\n        classicFisher = as.numeric(\n            stringr::str_replace(classicFisher, \"< \", \"\")\n        ),\n        Term = factor(Term(GO.ID),\n            levels = rev(Term(GO.ID))\n        )\n    )\n\nggplot2::ggplot(\n    enriched_gos,\n    ggplot2::aes(\n        y = -log10(classicFisher),\n        x = Term\n    )\n) +\n    ggplot2::geom_bar(stat = \"identity\", fill = \"grey70\") +\n    ggplot2::coord_flip() +\n    ggplot2::labs(x = NULL) +\n    ggplot2::theme_classic() +\n    ggplot2::scale_y_continuous(\n        name = expression(paste(\"-log\"[10], \" (p-value)\")),\n        breaks = c(0, 30),\n        labels = scales::math_format(10^.x)\n    ) +\n    ggplot2::annotate(\n        geom = \"text\",\n        x = seq_len(nrow(enriched_gos)),\n        y = rep(1, nrow(enriched_gos)),\n        label = rev(enriched_gos$Term),\n        # vjust = \"inward\",\n        hjust = \"inward\",\n        size = 2.5,\n        family = \"Arial\"\n    ) +\n    ggplot2::theme(\n        axis.title = ggplot2::element_text(family = \"Arial\", size = 8),\n        axis.title.y = ggplot2::element_blank(),\n        axis.text = ggplot2::element_text(family = \"Arial\", size = 7),\n        axis.text.y = ggplot2::element_blank(),\n        axis.ticks.y = ggplot2::element_blank(),\n        axis.line.y = ggplot2::element_blank(),\n        legend.text = ggplot2::element_text(family = \"Arial\", size = 8),\n        legend.title = ggplot2::element_text(family = \"Arial\", size = 8)\n    )"
  },
  {
    "objectID": "unbiased_reprogramming.html#enrichment-of-exogenous-factors",
    "href": "unbiased_reprogramming.html#enrichment-of-exogenous-factors",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "Enrichment of exogenous factors",
    "text": "Enrichment of exogenous factors\n\n# clusters_selected <- c(1, 2, 3, 10, 12, 17, 20, 22)\n\nfeatures_selected_43 <- c(\n    \"ENSMUSG00000025930_Msc\",\n    \"ENSMUSG00000026313_Hdac4\",\n    \"ENSMUSG00000026565_Pou2f1\",\n    \"ENSMUSG00000026923_Notch1\",\n    \"ENSMUSG00000015846_Rxra\",\n    \"ENSMUSG00000015627_Gata5\",\n    \"ENSMUSG00000025860_Xiap\",\n    \"ENSMUSG00000040289_Hey1\",\n    \"ENSMUSG00000027833_Shox2\",\n    \"ENSMUSG00000001419_Mef2d\",\n    \"ENSMUSG00000028800_Hdac1\",\n    \"ENSMUSG00000086369_E330017L17Rik\",\n    \"ENSMUSG00000028949_Smarcd3\",\n    \"ENSMUSG00000048450_Msx1\",\n    \"ENSMUSG00000042002_Foxn4\",\n    \"ENSMUSG00000018604_Tbx3\",\n    \"ENSMUSG00000018263_Tbx5\",\n    \"ENSMUSG00000063568_Jazf1\",\n    \"ENSMUSG00000009471_Myod1\",\n    \"ENSMUSG00000030557_Mef2a\",\n    \"ENSMUSG00000030551_Nr2f2\",\n    \"ENSMUSG00000030544_Mesp1\",\n    \"ENSMUSG00000019789_Hey2\",\n    \"ENSMUSG00000019777_Hdac2\",\n    \"ENSMUSG00000020167_Tcf3\",\n    \"ENSMUSG00000038193_Hand2\",\n    \"ENSMUSG00000079033_Mef2b\",\n    \"ENSMUSG00000021944_Gata4\",\n    \"ENSMUSG00000032419_Tbx18\",\n    \"ENSMUSG00000020160_Meis1\",\n    \"ENSMUSG00000037335_Hand1\",\n    \"ENSMUSG00000020542_Myocd\",\n    \"ENSMUSG00000000093_Tbx2\",\n    \"ENSMUSG00000021469_Msx2\",\n    \"ENSMUSG00000005583_Mef2c\",\n    \"ENSMUSG00000042258_Isl1\",\n    \"ENSMUSG00000009739_Pou6f1\",\n    \"ENSMUSG00000001288_Rarg\",\n    \"ENSMUSG00000015579_Nkx2-5\",\n    \"ENSMUSG00000023067_Cdkn1a\",\n    \"ENSMUSG00000024063_Lbh\",\n    \"ENSMUSG00000005836_Gata6\",\n    \"ENSMUSG00000024515_Smad4\"\n)\n\n\nclusters_selected <- c(20, 12, 2)\n\nenriched_factors <- do.call(\n    rbind.data.frame,\n    lapply(clusters_selected, \\(x) {\n        cells_1 <- embedding$cell[\n            embedding$cluster == x & embedding$category == \"JD168\"\n        ]\n        cells_2 <- embedding$cell[\n            embedding$cluster != x & embedding$category == \"JD168\"\n        ]\n        cat(x, length(cells_1), length(cells_2), \"\\n\")\n\n        de_paired <- detect_de(\n            cell_group_a = cells_1,\n            cell_group_b = cells_2,\n            matrix_readcount = matrix_readcount_use,\n            matrix_cpm = calc_cpm(matrix_readcount_use),\n            only_enrichment = TRUE\n        ) |>\n            dplyr::mutate(category = x) |>\n            tibble::rownames_to_column(var = \"feature\") |>\n            dplyr::filter(feature %in% features_selected_43)\n    })\n) |>\n    dplyr::filter(category %in% clusters_selected) |>\n    dplyr::mutate(\n        category = factor(category,\n            levels = clusters_selected\n        ),\n        symbol = stringr::str_remove(\n            string = feature,\n            pattern = \"^.+_\"\n        )\n    )\n\n20 164 8566 \n12 201 8529 \n2 2445 6285 \n\n\n\nDifferential expression analysis of 48F in MEF-derived clusters, as compared with all other reprogrammed cells. Each dot represents a gene (colored by fold change and sized by p value).\n\nggplot2::ggplot() +\n    ggplot2::geom_abline(intercept = 0, slope = 1, linetype = 2) +\n    ggplot2::geom_point(\n        data = enriched_factors,\n        ggplot2::aes(positive_frac_b,\n            positive_frac_a,\n            size = -log10(pval_adj),\n            color = log2_effect\n        ),\n        alpha = .8,\n        stroke = 0, shape = 16\n    ) +\n    ggplot2::facet_wrap(\n        ~category,\n        nrow = 1,\n        labeller = ggplot2::labeller(\n            category = setNames(\n                object = paste(\"Cluster\", clusters_selected),\n                nm = clusters_selected\n            )\n        )\n    ) +\n    ggplot2::coord_fixed() +\n    ggplot2::scale_color_viridis_c(\n        name = expression(paste(\"Log\"[2], \" effect\"))\n    ) +\n    ggplot2::scale_size_continuous(\n        name = expression(paste(\"-log\"[10], \" (p-value)\"))\n    ) +\n    ggplot2::guides(\n        color = ggplot2::guide_colorbar(order = 1),\n        size = ggplot2::guide_legend(order = 2)\n    ) +\n    ggplot2::scale_x_continuous(\n        name = \"Expr (%, other reprogrammed cells)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    ggplot2::scale_y_continuous(\n        name = \"Expr (%, indicated cluster)\",\n        limits = c(0, 1), breaks = seq(0, 1, .2)\n    ) +\n    theme_customized_violin() %+replace%\n    ggplot2::theme(\n        legend.background = ggplot2::element_blank(),\n        legend.margin = ggplot2::margin(t = 0, r = 0, b = 0, l = 0, unit = \"mm\"),\n        legend.key.size = ggplot2::unit(2.5, \"mm\"),\n        legend.text = ggplot2::element_text(family = \"Arial\", size = 6),\n        legend.title = ggplot2::element_text(family = \"Arial\", size = 7),\n        legend.position = \"bottom\",\n        legend.box = \"horizontal\",\n        legend.box.background = ggplot2::element_blank()\n    ) +\n    ggrepel::geom_text_repel(\n        data = subset(enriched_factors, symbol %in% c(\n            \"Myod1\", \"Mef2b\",\n            \"Mef2c\", \"Hand2\", \"Gata6\"\n        )),\n        ggplot2::aes(\n            positive_frac_b,\n            positive_frac_a,\n            label = symbol\n        ),\n        #\n        size = 5 / ggplot2::.pt,\n        family = \"Arial\",\n        box.padding = .2,\n        point.padding = .2,\n        nudge_y = .15,\n        arrow = ggplot2::arrow(length = ggplot2::unit(.02, \"npc\")),\n        segment.color = \"grey35\",\n        color = \"black\"\n    )"
  },
  {
    "objectID": "unbiased_reprogramming.html#r-session-info",
    "href": "unbiased_reprogramming.html#r-session-info",
    "title": "Unbiased Reprogramming with 48 Factors by Reprogram-Seq",
    "section": "R session info",
    "text": "R session info\n\ndevtools::session_info()\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23)\n os       macOS Monterey 12.6\n system   aarch64, darwin21.6.0\n ui       unknown\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       America/Chicago\n date     2022-09-24\n pandoc   2.19.2 @ /opt/homebrew/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package          * version       date (UTC) lib source\n AnnotationDbi    * 1.58.0        2022-04-26 [1] Bioconductor\n Biobase          * 2.56.0        2022-04-26 [1] Bioconductor\n BiocGenerics     * 0.42.0        2022-04-26 [1] Bioconductor\n Biostrings         2.64.1        2022-08-18 [1] Bioconductor\n bit                4.0.4         2020-08-04 [1] CRAN (R 4.2.0)\n bit64              4.0.5         2020-08-30 [1] CRAN (R 4.2.0)\n bitops             1.0-7         2021-04-24 [1] CRAN (R 4.2.0)\n blob               1.2.3         2022-04-10 [1] CRAN (R 4.2.0)\n cachem             1.0.6         2021-08-19 [1] CRAN (R 4.2.0)\n callr              3.7.2         2022-08-22 [1] CRAN (R 4.2.1)\n cli                3.4.1         2022-09-23 [1] CRAN (R 4.2.1)\n colorspace         2.0-3         2022-02-21 [1] CRAN (R 4.2.0)\n commonmark         1.8.0         2022-03-09 [1] CRAN (R 4.2.0)\n crayon             1.5.1         2022-03-26 [1] CRAN (R 4.2.0)\n DBI                1.1.3         2022-06-18 [1] CRAN (R 4.2.0)\n devtools           2.4.4.9000    2022-09-23 [1] Github (r-lib/devtools@9e2793a)\n digest             0.6.29        2021-12-01 [1] CRAN (R 4.2.0)\n dplyr            * 1.0.99.9000   2022-09-23 [1] Github (tidyverse/dplyr@19c2be3)\n ellipsis           0.3.2         2021-04-29 [1] CRAN (R 4.2.0)\n evaluate           0.16          2022-08-09 [1] CRAN (R 4.2.1)\n extrafont        * 0.18          2022-04-12 [1] CRAN (R 4.2.0)\n extrafontdb        1.0           2012-06-11 [1] CRAN (R 4.2.0)\n fansi              1.0.3         2022-03-24 [1] CRAN (R 4.2.0)\n farver             2.1.1         2022-07-06 [1] CRAN (R 4.2.1)\n fastmap            1.1.0         2021-01-25 [1] CRAN (R 4.2.0)\n forcats          * 0.5.2.9000    2022-08-20 [1] Github (tidyverse/forcats@bd319e0)\n formattable      * 0.2.1         2021-01-07 [1] CRAN (R 4.2.1)\n fs                 1.5.2.9000    2022-08-24 [1] Github (r-lib/fs@238032f)\n generics           0.1.3         2022-07-05 [1] CRAN (R 4.2.1)\n GenomeInfoDb       1.32.4        2022-09-06 [1] Bioconductor\n GenomeInfoDbData   1.2.8         2022-04-22 [1] Bioconductor\n ggplot2          * 3.3.6.9000    2022-09-12 [1] Github (tidyverse/ggplot2@a58b48c)\n ggrepel            0.9.1         2021-01-15 [1] CRAN (R 4.2.0)\n glue               1.6.2.9000    2022-04-22 [1] Github (tidyverse/glue@d47d6c7)\n GO.db            * 3.15.0        2022-04-22 [1] Bioconductor\n graph            * 1.74.0        2022-04-26 [1] Bioconductor\n gt                 0.7.0.9000    2022-09-23 [1] Github (rstudio/gt@4030fb7)\n gtable             0.3.1.9000    2022-09-01 [1] Github (r-lib/gtable@c1a7a81)\n highr              0.9           2021-04-16 [1] CRAN (R 4.2.0)\n hms                1.1.2         2022-08-19 [1] CRAN (R 4.2.1)\n htmltools          0.5.3         2022-07-18 [1] CRAN (R 4.2.1)\n htmlwidgets        1.5.4         2022-08-23 [1] Github (ramnathv/htmlwidgets@400cf1a)\n httpuv             1.6.6         2022-09-08 [1] CRAN (R 4.2.1)\n httr               1.4.4         2022-08-17 [1] CRAN (R 4.2.1)\n IRanges          * 2.30.1        2022-08-18 [1] Bioconductor\n jsonlite           1.8.0         2022-02-22 [1] CRAN (R 4.2.0)\n KEGGREST           1.36.3        2022-07-12 [1] Bioconductor\n knitr              1.40          2022-08-24 [1] CRAN (R 4.2.1)\n labeling           0.4.2         2020-10-20 [1] CRAN (R 4.2.0)\n later              1.3.0         2021-08-18 [1] CRAN (R 4.2.0)\n lattice            0.20-45       2021-09-22 [2] CRAN (R 4.2.1)\n lifecycle          1.0.2.9000    2022-09-23 [1] Github (r-lib/lifecycle@0a6860a)\n lubridate        * 1.8.0.9000    2022-05-24 [1] Github (tidyverse/lubridate@0bb49b2)\n magrittr           2.0.3         2022-03-30 [1] CRAN (R 4.2.0)\n Matrix           * 1.5-1         2022-09-13 [1] CRAN (R 4.2.1)\n matrixStats        0.62.0        2022-04-19 [1] CRAN (R 4.2.0)\n memoise            2.0.1         2021-11-26 [1] CRAN (R 4.2.0)\n mime               0.12          2021-09-28 [1] CRAN (R 4.2.0)\n miniUI             0.1.1.1       2018-05-18 [1] CRAN (R 4.2.0)\n munsell            0.5.0         2018-06-12 [1] CRAN (R 4.2.0)\n org.Mm.eg.db     * 3.15.0        2022-07-11 [1] Bioconductor\n patchwork        * 1.1.2.9000    2022-08-20 [1] Github (thomasp85/patchwork@c14c960)\n pillar             1.8.1         2022-08-19 [1] CRAN (R 4.2.1)\n pkgbuild           1.3.1         2021-12-20 [1] CRAN (R 4.2.0)\n pkgconfig          2.0.3         2019-09-22 [1] CRAN (R 4.2.0)\n pkgload            1.3.0         2022-06-27 [1] CRAN (R 4.2.1)\n png                0.1-7         2013-12-03 [1] CRAN (R 4.2.0)\n prettyunits        1.1.1.9000    2022-04-22 [1] Github (r-lib/prettyunits@8706d89)\n processx           3.7.0         2022-07-07 [1] CRAN (R 4.2.1)\n profvis            0.3.7         2020-11-02 [1] CRAN (R 4.2.0)\n promises           1.2.0.1       2021-02-11 [1] CRAN (R 4.2.0)\n ps                 1.7.1         2022-06-18 [1] CRAN (R 4.2.0)\n purrr            * 0.9000.0.9000 2022-09-23 [1] Github (tidyverse/purrr@7b5578c)\n R.cache            0.16.0        2022-07-21 [1] CRAN (R 4.2.1)\n R.methodsS3        1.8.2         2022-06-13 [1] CRAN (R 4.2.0)\n R.oo               1.25.0        2022-06-12 [1] CRAN (R 4.2.0)\n R.utils            2.12.0        2022-06-28 [1] CRAN (R 4.2.1)\n R6                 2.5.1.9000    2022-08-04 [1] Github (r-lib/R6@87d5e45)\n ragg               1.2.2.9000    2022-09-12 [1] Github (r-lib/ragg@904e145)\n Rcpp               1.0.9         2022-07-08 [1] CRAN (R 4.2.1)\n RCurl              1.98-1.8      2022-07-30 [1] CRAN (R 4.2.1)\n readr            * 2.1.2.9000    2022-09-20 [1] Github (tidyverse/readr@5cac6ed)\n remotes            2.4.2         2022-09-12 [1] Github (r-lib/remotes@bc0949d)\n rlang              1.0.5.9000    2022-09-23 [1] Github (r-lib/rlang@a72c03c)\n rmarkdown          2.16.1        2022-08-25 [1] Github (rstudio/rmarkdown@b8a9879)\n RSQLite            2.2.17        2022-09-10 [1] CRAN (R 4.2.1)\n Rttf2pt1           1.3.10        2022-02-07 [1] CRAN (R 4.2.0)\n S4Vectors        * 0.34.0        2022-04-26 [1] Bioconductor\n sass               0.4.2         2022-07-16 [1] CRAN (R 4.2.1)\n scales             1.2.1.9000    2022-08-20 [1] Github (r-lib/scales@b3df2fb)\n sessioninfo        1.2.2         2021-12-06 [1] CRAN (R 4.2.0)\n shiny              1.7.2         2022-07-19 [1] CRAN (R 4.2.1)\n SparseM          * 1.81          2021-02-18 [1] CRAN (R 4.2.1)\n stringi            1.7.8         2022-07-11 [1] CRAN (R 4.2.1)\n stringr          * 1.4.1.9000    2022-08-21 [1] Github (tidyverse/stringr@792bc92)\n styler           * 1.7.0.9002    2022-09-21 [1] Github (r-lib/styler@1f4437b)\n systemfonts        1.0.4         2022-02-11 [1] CRAN (R 4.2.0)\n textshaping        0.3.6         2021-10-13 [1] CRAN (R 4.2.0)\n tibble           * 3.1.8.9001    2022-09-23 [1] Github (tidyverse/tibble@eb132e7)\n tidyr            * 1.2.1.9000    2022-09-09 [1] Github (tidyverse/tidyr@653def2)\n tidyselect         1.1.2.9000    2022-09-21 [1] Github (r-lib/tidyselect@edd0a3b)\n tidyverse        * 1.3.2.9000    2022-09-12 [1] Github (tidyverse/tidyverse@3be8283)\n topGO            * 2.48.0        2022-04-26 [1] Bioconductor\n tzdb               0.3.0         2022-03-28 [1] CRAN (R 4.2.0)\n urlchecker         1.0.1         2021-11-30 [1] CRAN (R 4.2.0)\n usethis            2.1.6.9000    2022-09-23 [1] Github (r-lib/usethis@8ecb7ab)\n utf8               1.2.2         2021-07-24 [1] CRAN (R 4.2.0)\n vctrs              0.4.1.9000    2022-09-19 [1] Github (r-lib/vctrs@0a219ba)\n viridisLite        0.4.1         2022-08-22 [1] CRAN (R 4.2.1)\n vroom              1.5.7.9000    2022-09-09 [1] Github (r-lib/vroom@0c2423e)\n withr              2.5.0         2022-03-03 [1] CRAN (R 4.2.0)\n xfun               0.33          2022-09-12 [1] CRAN (R 4.2.1)\n xtable             1.8-4         2019-04-21 [1] CRAN (R 4.2.0)\n XVector            0.36.0        2022-04-26 [1] Bioconductor\n yaml               2.3.5         2022-02-21 [1] CRAN (R 4.2.0)\n zlibbioc           1.42.0        2022-04-26 [1] Bioconductor\n\n [1] /opt/homebrew/lib/R/4.2/site-library\n [2] /opt/homebrew/Cellar/r/4.2.1_4/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────"
  }
]